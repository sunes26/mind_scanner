import { NextRequest, NextResponse } from 'next/server'
import OpenAI from 'openai'
import { isValidAnalysisResult, validateEnvironmentVariables, API_TIMEOUTS } from '@/utils/validation'
import { sanitizeNumber } from '@/utils/sanitize'
import { SupportedLanguage } from '@/utils/language'

// ë³´ì•ˆ: í™˜ê²½ ë³€ìˆ˜ ê²€ì¦
const envCheck = validateEnvironmentVariables()
if (!envCheck.isValid) {
  console.error('Missing required environment variables:', envCheck.missingVars)
  throw new Error(`Missing environment variables: ${envCheck.missingVars.join(', ')}`)
}

const openai = new OpenAI({
  apiKey: process.env.OPENAI_API_KEY,
  timeout: API_TIMEOUTS.ANALYSIS,
})

// ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ - ì—°ì•  ì‹¬ë¦¬ ì „ë¬¸ê°€ í˜ë¥´ì†Œë‚˜ (ì–¸ì–´ë³„)
function getSystemPrompt(lang: SupportedLanguage): string {
  if (lang === 'ko') {
    return `ë„ˆëŠ” "ì—°ì•  ì‹¬ë¦¬ ë¶„ì„ê°€ ë‹¥í„° í•˜íŠ¸"ì•¼.
10ë…„ê°„ ìˆ˜ì²œ ê±´ì˜ ì—°ì•  ìƒë‹´ì„ í•´ì˜¨ ì „ë¬¸ê°€ë¡œ, ì¹´ì¹´ì˜¤í†¡ ëŒ€í™” íŒ¨í„´ë§Œ ë³´ê³ ë„ ë‘ ì‚¬ëŒì˜ ê´€ê³„ë¥¼ ì •í™•íˆ íŒŒì•…í•  ìˆ˜ ìˆì–´.

## ë¶„ì„ ì›ì¹™
1. ë°ì´í„° ê¸°ë°˜: ì œê³µëœ í†µê³„ ìˆ˜ì¹˜ë¥¼ ê·¼ê±°ë¡œ ë¶„ì„í•´
2. ì¬ë¯¸ìˆê²Œ: MZì„¸ëŒ€ê°€ ì¢‹ì•„í•  ë§Œí•œ ìœ ë¨¸ì™€ ë°ˆì„ ì„ì–´ì„œ í‘œí˜„í•´
3. êµ¬ì²´ì ìœ¼ë¡œ: ë§‰ì—°í•œ ì¡°ì–¸ì´ ì•„ë‹Œ ì‹¤í–‰ ê°€ëŠ¥í•œ íŒì„ ì œê³µí•´
4. ê¸ì •ì ìœ¼ë¡œ: ì–´ë–¤ ê²°ê³¼ë“  í¬ë§ì ì¸ ë©”ì‹œì§€ë¥¼ ë‹´ì•„

## í˜¸ê°ë„ ì ìˆ˜ ê¸°ì¤€ (0-100)
- 90-100: ğŸ’ ê²°í˜¼ê°, ì™„ë²½í•œ ì¼€ë¯¸
- 80-89: ğŸ’• ì—°ì¸ í™•ì • ì§ì „, ê³ ë°±ë§Œ ë‚¨ìŒ
- 70-79: ğŸ’— ì¸ íƒ€ëŠ” ì¤‘, ì¢‹ì€ íë¦„
- 60-69: ğŸ’› í˜¸ê°ì€ ìˆìŒ, ì¡°ê¸ˆ ë” ë…¸ë ¥ í•„ìš”
- 50-59: ğŸ¤” ì• ë§¤í•¨, ë°©í–¥ ì„¤ì • í•„ìš”
- 40-49: ğŸ˜… í•œìª½ë§Œ ê´€ì‹¬ ìˆì„ ìˆ˜ë„
- 0-39: ğŸ’” ì¹œêµ¬ ì‚¬ì´ì— ê°€ê¹Œì›€

## ì£¼ë„ê¶Œ íŒë‹¨ ê¸°ì¤€
- ë¨¼ì € ì—°ë½í•˜ëŠ” íšŸìˆ˜
- ë‹µì¥ ì†ë„ ì°¨ì´ (ë¹ ë¥¼ìˆ˜ë¡ ê´€ì‹¬ ë†’ìŒ)
- ë©”ì‹œì§€ ê¸¸ì´ ì°¨ì´
- ì§ˆë¬¸ì„ ë” ë§ì´ í•˜ëŠ” ìª½
- ì´ëª¨í‹°ì½˜/ã…‹ã…‹ ì‚¬ìš©ëŸ‰ (ë§ì´ ì“°ëŠ” ìª½ì´ ë” ê´€ì‹¬ ìˆìŒ)

## ì‘ë‹µ ê·œì¹™
- ë°˜ë“œì‹œ ì§€ì •ëœ JSON í˜•ì‹ìœ¼ë¡œë§Œ ì‘ë‹µ
- ì´ëª¨ì§€ë¥¼ ì ê·¹ í™œìš©
- í•œêµ­ì–´ë¡œ ì‘ë‹µ
- ë¶„ì„ ë‚´ìš©ì€ 2-3ë¬¸ì¥ìœ¼ë¡œ ê°„ê²°í•˜ê²Œ`
  }

  // English version
  return `You are "Dr. Heart", a relationship psychology analyst.
With 10 years of experience analyzing thousands of conversations, you can accurately assess relationships just by examining chat patterns.

## Analysis Principles
1. Data-driven: Base your analysis on the provided statistics
2. Engaging: Use relatable language and insights
3. Specific: Provide actionable tips, not vague advice
4. Positive: Include hopeful messages regardless of the results

## Affection Score Criteria (0-100)
- 90-100: ğŸ’ Perfect chemistry, marriage material
- 80-89: ğŸ’• Almost dating, just need to confess
- 70-79: ğŸ’— Dating phase, good flow
- 60-69: ğŸ’› Some interest, needs more effort
- 50-59: ğŸ¤” Ambiguous, needs direction
- 40-49: ğŸ˜… One-sided interest possible
- 0-39: ğŸ’” Just friends

## Dominance Criteria
- Who initiates conversations more
- Reply speed difference (faster = more interested)
- Message length difference
- Who asks more questions
- Emoji/laughter usage (more = more interested)

## Response Rules
- Respond ONLY in the specified JSON format
- Use emojis actively
- Respond in English
- Keep analysis concise (2-3 sentences)`
}

// ë¶„ì„ ìš”ì²­ í”„ë¡¬í”„íŠ¸ ìƒì„±
function createAnalysisPrompt(data: {
  rawText: string
  p1: string
  p2: string
  analysis?: any
  lang?: SupportedLanguage
}): string {
  const { rawText, p1, p2, analysis, lang = 'ko' } = data

  // ëŒ€í™” ìƒ˜í”Œ ì¶”ì¶œ (ìµœê·¼ ëŒ€í™” ìœ„ì£¼)
  const recentChat = rawText.slice(-5000)

  let analysisText = ''
  if (analysis?.participants) {
    const p1Stats = analysis.participants[p1]
    const p2Stats = analysis.participants[p2]

    // ë‹µì¥ ì‹œê°„ì„ ì½ê¸° ì‰¬ìš´ í˜•ì‹ìœ¼ë¡œ ë³€í™˜
    const formatReplyTime = (minutes: number) => {
      if (lang === 'ko') {
        if (minutes === 0) return 'ì¦‰ì‹œ'
        if (minutes < 60) return `${minutes}ë¶„`
        if (minutes < 1440) return `${Math.round(minutes / 60)}ì‹œê°„`
        return `${Math.round(minutes / 1440)}ì¼`
      } else {
        if (minutes === 0) return 'instant'
        if (minutes < 60) return `${minutes}min`
        if (minutes < 1440) return `${Math.round(minutes / 60)}hr`
        return `${Math.round(minutes / 1440)}day`
      }
    }

    const p1Reply = formatReplyTime(p1Stats?.avgReplyTime || 0)
    const p2Reply = formatReplyTime(p2Stats?.avgReplyTime || 0)

    const p1LaughRatio = ((p1Stats?.laughCount || 0) / (p1Stats?.messageCount || 1)).toFixed(2)
    const p2LaughRatio = ((p2Stats?.laughCount || 0) / (p2Stats?.messageCount || 1)).toFixed(2)

    if (lang === 'ko') {
      analysisText = `
ì°¸ì—¬ì í†µê³„:
- ${p1}: ë©”ì‹œì§€ ${p1Stats?.messageCount || 0}ê°œ, í‰ê·  ê¸¸ì´ ${p1Stats?.avgMessageLength?.toFixed(1) || 0}ì, ì´ëª¨ì§€ ${p1Stats?.emojiCount || 0}ê°œ, ì›ƒìŒ ${p1Stats?.laughCount || 0}ê°œ (ë©”ì‹œì§€ë‹¹ ${p1LaughRatio}), í‰ê·  ë‹µì¥ ${p1Reply}
  â†’ í•˜íŠ¸ ì´ëª¨ì§€ ${p1Stats?.heartEmojiCount || 0}ê°œ, ì• ì • í‘œí˜„ ${p1Stats?.affectionWordCount || 0}íšŒ, ì—°ì† ë©”ì‹œì§€ ${p1Stats?.consecutiveMessageCount || 0}íšŒ
- ${p2}: ë©”ì‹œì§€ ${p2Stats?.messageCount || 0}ê°œ, í‰ê·  ê¸¸ì´ ${p2Stats?.avgMessageLength?.toFixed(1) || 0}ì, ì´ëª¨ì§€ ${p2Stats?.emojiCount || 0}ê°œ, ì›ƒìŒ ${p2Stats?.laughCount || 0}ê°œ (ë©”ì‹œì§€ë‹¹ ${p2LaughRatio}), í‰ê·  ë‹µì¥ ${p2Reply}
  â†’ í•˜íŠ¸ ì´ëª¨ì§€ ${p2Stats?.heartEmojiCount || 0}ê°œ, ì• ì • í‘œí˜„ ${p2Stats?.affectionWordCount || 0}íšŒ, ì—°ì† ë©”ì‹œì§€ ${p2Stats?.consecutiveMessageCount || 0}íšŒ
ì´ ëŒ€í™”: ${analysis.totalMessages || 0}ê°œ (${analysis.totalDays || 0}ì¼ê°„)
`
    } else {
      analysisText = `
Participant Statistics:
- ${p1}: ${p1Stats?.messageCount || 0} messages, avg length ${p1Stats?.avgMessageLength?.toFixed(1) || 0} chars, ${p1Stats?.emojiCount || 0} emojis, ${p1Stats?.laughCount || 0} laughs (${p1LaughRatio} per msg), avg reply ${p1Reply}
  â†’ ${p1Stats?.heartEmojiCount || 0} heart emojis, ${p1Stats?.affectionWordCount || 0} affection words, ${p1Stats?.consecutiveMessageCount || 0} consecutive msgs
- ${p2}: ${p2Stats?.messageCount || 0} messages, avg length ${p2Stats?.avgMessageLength?.toFixed(1) || 0} chars, ${p2Stats?.emojiCount || 0} emojis, ${p2Stats?.laughCount || 0} laughs (${p2LaughRatio} per msg), avg reply ${p2Reply}
  â†’ ${p2Stats?.heartEmojiCount || 0} heart emojis, ${p2Stats?.affectionWordCount || 0} affection words, ${p2Stats?.consecutiveMessageCount || 0} consecutive msgs
Total conversation: ${analysis.totalMessages || 0} messages (${analysis.totalDays || 0} days)
`
    }
  }

  if (lang === 'ko') {
    return `## ë¶„ì„ ëŒ€ìƒ
- ì°¸ì—¬ì 1: "${p1}"
- ì°¸ì—¬ì 2: "${p2}"

## ìƒì„¸ ë¶„ì„ ë°ì´í„°
${analysisText || '(ìƒì„¸ ë°ì´í„° ì—†ìŒ)'}

## ëŒ€í™” ë‚´ìš© ìƒ˜í”Œ (ìµœê·¼ ëŒ€í™”)
\`\`\`
${recentChat}
\`\`\`

## ìš”ì²­ì‚¬í•­
ìœ„ ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ ë‘ ì‚¬ëŒì˜ ê´€ê³„ë¥¼ ë¶„ì„í•´ì¤˜.

ë°˜ë“œì‹œ ì•„ë˜ JSON í˜•ì‹ìœ¼ë¡œë§Œ ì‘ë‹µí•´:
{
  "score": (0-100 ì‚¬ì´ ì •ìˆ˜, í˜¸ê°ë„ ì ìˆ˜),
  "dominance": "${p1} ë˜ëŠ” ${p2}",
  "attackTip": {
    "${p1}": "(${p1}ì—ê²Œ ë§ëŠ” êµ¬ì²´ì ì¸ ê³µëµ ì¡°ì–¸ 2-3ë¬¸ì¥)",
    "${p2}": "(${p2}ì—ê²Œ ë§ëŠ” êµ¬ì²´ì ì¸ ê³µëµ ì¡°ì–¸ 2-3ë¬¸ì¥)"
  },
  "personalities": {
    "${p1}": {
      "type": "(ëŒ€í™” íŒ¨í„´ ê¸°ë°˜ ì„±í–¥ íƒ€ì…, ì˜ˆ: ì ê·¹ì ì¸ ë¦¬ë”í˜•, ê°ì„±ì ì¸ ê³µê°í˜• ë“±)",
      "traits": ["íŠ¹ì§•1", "íŠ¹ì§•2", "íŠ¹ì§•3"],
      "description": "(3ë¬¸ì¥. ëŒ€í™” íŒ¨í„´, ê°ì • í‘œí˜„, ê´€ê³„ ìŠ¤íƒ€ì¼ ì„¤ëª…)"
    },
    "${p2}": {
      "type": "(ëŒ€í™” íŒ¨í„´ ê¸°ë°˜ ì„±í–¥ íƒ€ì…)",
      "traits": ["íŠ¹ì§•1", "íŠ¹ì§•2", "íŠ¹ì§•3"],
      "description": "(3ë¬¸ì¥. ëŒ€í™” íŒ¨í„´, ê°ì • í‘œí˜„, ê´€ê³„ ìŠ¤íƒ€ì¼ ì„¤ëª…)"
    }
  },
  "mutualPerception": {
    "${p1}": {
      "thinkingAboutYou": "(${p2}ê°€ ${p1}ë¥¼ ì–´ë–»ê²Œ ë³´ëŠ”ì§€ 3ë¬¸ì¥)",
      "youThinkingAbout": "(${p1}ê°€ ${p2}ë¥¼ ì–´ë–»ê²Œ ë³´ëŠ”ì§€ 3ë¬¸ì¥)"
    },
    "${p2}": {
      "thinkingAboutYou": "(${p1}ê°€ ${p2}ë¥¼ ì–´ë–»ê²Œ ë³´ëŠ”ì§€ 3ë¬¸ì¥)",
      "youThinkingAbout": "(${p2}ê°€ ${p1}ë¥¼ ì–´ë–»ê²Œ ë³´ëŠ”ì§€ 3ë¬¸ì¥)"
    }
  }
}

ì¤‘ìš”: ìœ íš¨í•œ JSONë§Œ ì‘ë‹µ. ì¤„ë°”ê¿ˆ ê¸ˆì§€. ë”°ì˜´í‘œëŠ” ì‘ì€ë”°ì˜´í‘œë¡œ ëŒ€ì²´.`
  }

  // English version
  return `## Analysis Target
- Participant 1: "${p1}"
- Participant 2: "${p2}"

## Detailed Analysis Data
${analysisText || '(No detailed data)'}

## Conversation Sample (Recent messages)
\`\`\`
${recentChat}
\`\`\`

## Request
Analyze the relationship between these two people based on the data above.

Respond ONLY in the following JSON format:
{
  "score": (integer between 0-100, affection score),
  "dominance": "${p1} or ${p2}",
  "attackTip": {
    "${p1}": "(Specific relationship advice for ${p1} in 2-3 sentences)",
    "${p2}": "(Specific relationship advice for ${p2} in 2-3 sentences)"
  },
  "personalities": {
    "${p1}": {
      "type": "(Personality type based on chat patterns, e.g., Proactive Leader, Empathetic Listener)",
      "traits": ["trait1", "trait2", "trait3"],
      "description": "(3 sentences describing chat patterns, emotional expression, relationship style)"
    },
    "${p2}": {
      "type": "(Personality type based on chat patterns)",
      "traits": ["trait1", "trait2", "trait3"],
      "description": "(3 sentences describing chat patterns, emotional expression, relationship style)"
    }
  },
  "mutualPerception": {
    "${p1}": {
      "thinkingAboutYou": "(How ${p2} perceives ${p1} in 3 sentences)",
      "youThinkingAbout": "(How ${p1} perceives ${p2} in 3 sentences)"
    },
    "${p2}": {
      "thinkingAboutYou": "(How ${p1} perceives ${p2} in 3 sentences)",
      "youThinkingAbout": "(How ${p2} perceives ${p1} in 3 sentences)"
    }
  }
}

Important: Respond with valid JSON only. No line breaks. Use single quotes instead of double quotes in text.`
}

export async function POST(request: NextRequest) {
  try {
    const body = await request.json()
    const { rawText, p1, p2, analysis, language = 'ko' } = body
    const lang: SupportedLanguage = language

    // ë³´ì•ˆ: ì…ë ¥ ë°ì´í„° ê²€ì¦
    if (!rawText || typeof rawText !== 'string') {
      return NextResponse.json(
        { error: 'ìœ íš¨í•˜ì§€ ì•Šì€ ëŒ€í™” ë‚´ìš©ì…ë‹ˆë‹¤.' },
        { status: 400 }
      )
    }

    if (!p1 || !p2 || typeof p1 !== 'string' || typeof p2 !== 'string') {
      return NextResponse.json(
        { error: 'ìœ íš¨í•˜ì§€ ì•Šì€ ì°¸ì—¬ì ì •ë³´ì…ë‹ˆë‹¤.' },
        { status: 400 }
      )
    }

    if (rawText.length === 0 || rawText.length > 500000) {
      return NextResponse.json(
        { error: 'ëŒ€í™” ë‚´ìš©ì˜ ê¸¸ì´ê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.' },
        { status: 400 }
      )
    }

    if (p1.length === 0 || p2.length === 0 || p1.length > 50 || p2.length > 50) {
      return NextResponse.json(
        { error: 'ì°¸ì—¬ì ì´ë¦„ì˜ ê¸¸ì´ê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.' },
        { status: 400 }
      )
    }

    // API í‚¤ í™•ì¸
    if (!process.env.OPENAI_API_KEY) {
      console.log('OpenAI API key not configured, returning mock data')
      // API í‚¤ê°€ ì—†ìœ¼ë©´ ëª©ì—… ë°ì´í„° ë°˜í™˜
      return NextResponse.json(generateMockResult(p1, p2, analysis, lang))
    }

    const prompt = createAnalysisPrompt({
      rawText,
      p1,
      p2,
      analysis,
      lang,
    })

    const completion = await openai.chat.completions.create({
      model: 'gpt-4o-mini',
      messages: [
        {
          role: 'system',
          content: getSystemPrompt(lang),
        },
        {
          role: 'user',
          content: prompt,
        },
      ],
      temperature: 0.7,
      max_tokens: 800,
      response_format: { type: 'json_object' },
    })

    const content = completion.choices[0].message.content

    if (!content) {
      throw new Error('Empty response from OpenAI')
    }

    let result
    try {
      result = JSON.parse(content)
    } catch (parseError) {
      console.error('JSON parse error:', parseError)
      console.error('Content:', content)
      // JSON íŒŒì‹± ì‹¤íŒ¨ ì‹œ Mock ë°ì´í„°ë¡œ fallback
      return NextResponse.json(generateMockResult(p1, p2, analysis, lang))
    }

    // ë³´ì•ˆ: ì‘ë‹µ êµ¬ì¡° ê²€ì¦
    if (!isValidAnalysisResult(result)) {
      console.error('Invalid analysis result structure, falling back to mock data')
      return NextResponse.json(generateMockResult(p1, p2, analysis, lang))
    }

    // ë³´ì•ˆ: ì ìˆ˜ ë²”ìœ„ ê²€ì¦
    const score = sanitizeNumber(result.score, 0, 100, 70)

    const validatedResult = {
      score,
      relation: getRelationByScore(score, lang), // AI ìƒì„± ëŒ€ì‹  ì ìˆ˜ ê¸°ë°˜ ëœë¤ ì„ íƒ
      dominance: result.dominance || p1,
      attackTip: result.attackTip || '',
      personalities: result.personalities || {},
      mutualPerception: result.mutualPerception || {},
    }

    return NextResponse.json(validatedResult)

  } catch (error) {
    console.error('Analysis error:', error)

    // ì—ëŸ¬ ë°œìƒ ì‹œ ëª©ì—… ë°ì´í„° ë°˜í™˜
    const body = await request.json().catch(() => ({}))
    return NextResponse.json(
      generateMockResult(
        body.p1 || 'ì‚¬ëŒ1',
        body.p2 || 'ì‚¬ëŒ2',
        body.analysis,
        body.language || 'ko'
      )
    )
  }
}

// ì ìˆ˜ êµ¬ê°„ë³„ ê´€ê³„ í…ìŠ¤íŠ¸ ìƒì„± í•¨ìˆ˜
function getRelationByScore(score: number, lang: SupportedLanguage = 'ko'): string {
  if (lang === 'ko') {
    const relations90to100 = [
      'ì„œë¡œì—ê²Œ ë§¤ìš° ì¤‘ìš”í•œ ì¡´ì¬',
      'ìµœê³  ìˆ˜ì¤€ì˜ ìƒí˜¸ êµê°',
      'ê¹Šì€ ì‹ ë¢°ê°€ í˜•ì„±ëœ ê´€ê³„',
      'ì™„ë²½í•œ ëŒ€í™” ì¼€ë¯¸ìŠ¤íŠ¸ë¦¬',
    ]

    const relations80to89 = [
      'ì„œë¡œì—ê²Œ ë†’ì€ ê´€ì‹¬ì„ ë³´ì´ëŠ” ì‚¬ì´',
      'í¸ì•ˆí•˜ê³  ê¸ì •ì ì¸ ê´€ê³„',
      'í™œë°œí•œ ì†Œí†µì´ ì´ë£¨ì–´ì§€ëŠ” ì‚¬ì´',
      'ìƒí˜¸ í˜¸ê°ì´ í™•ì‹¤í•œ ê´€ê³„',
    ]

    const relations70to79 = [
      'ì•ˆì •ì ìœ¼ë¡œ ì†Œí†µí•˜ëŠ” ê´€ê³„',
      'ì„œë¡œì—ê²Œ ê´€ì‹¬ì´ ìˆëŠ” ì‚¬ì´',
      'ê· í˜• ì¡íŒ ëŒ€í™” íŒ¨í„´',
      'ì ì  ê°€ê¹Œì›Œì§€ê³  ìˆëŠ” ì¤‘',
    ]

    const relations60to69 = [
      'ê´€ê³„ ë°œì „ ê°€ëŠ¥ì„±ì´ ìˆëŠ” ì‚¬ì´',
      'ì„œë¡œë¥¼ íŒŒì•…í•´ê°€ëŠ” ë‹¨ê³„',
      'ì¡°ê¸ˆ ë” ë…¸ë ¥ì´ í•„ìš”í•œ ê´€ê³„',
      'ì•„ì§ íƒìƒ‰ ì¤‘ì¸ ì‚¬ì´',
    ]

    const relations50to59 = [
      'í•œìª½ì´ ë” ì ê·¹ì ì¸ ê´€ê³„',
      'ê´€ì‹¬ë„ì— ì˜¨ë„ì°¨ê°€ ìˆëŠ” ì‚¬ì´',
      'ì†Œí†µ ê· í˜•ì´ í•„ìš”í•œ ê´€ê³„',
      'ë°©í–¥ ì„¤ì •ì´ í•„ìš”í•œ ë‹¨ê³„',
    ]

    const relations40to49 = [
      'ì†Œê·¹ì ì¸ ì†Œí†µ íŒ¨í„´',
      'í•œìª½ì˜ ì¼ë°©ì ì¸ ê´€ì‹¬',
      'ëŒ€í™”ê°€ ìì£¼ ëŠê¸°ëŠ” ì‚¬ì´',
      'ì ê·¹ì„±ì´ ë¶€ì¡±í•œ ê´€ê³„',
    ]

    const relations0to39 = [
      'í‰ë²”í•œ ì§€ì¸ ê´€ê³„',
      'ì†Œí†µì´ ì œí•œì ì¸ ì‚¬ì´',
      'ì¹œêµ¬ ì´ìƒì˜ ê´€ì‹¬ì€ ì—†ëŠ” ë“¯',
      'í˜•ì‹ì ì¸ ëŒ€í™”ê°€ ë§ì€ ê´€ê³„',
    ]

    let selectedArray: string[]

    if (score >= 90) selectedArray = relations90to100
    else if (score >= 80) selectedArray = relations80to89
    else if (score >= 70) selectedArray = relations70to79
    else if (score >= 60) selectedArray = relations60to69
    else if (score >= 50) selectedArray = relations50to59
    else if (score >= 40) selectedArray = relations40to49
    else selectedArray = relations0to39

    return selectedArray[Math.floor(Math.random() * selectedArray.length)]
  }

  // English version
  const relations90to100 = [
    'Very important to each other',
    'Highest level of mutual connection',
    'Deep trust has been established',
    'Perfect conversation chemistry',
  ]

  const relations80to89 = [
    'Showing high interest in each other',
    'Comfortable and positive relationship',
    'Active communication happening',
    'Clear mutual affection',
  ]

  const relations70to79 = [
    'Stable communication pattern',
    'Interested in each other',
    'Balanced conversation flow',
    'Getting closer gradually',
  ]

  const relations60to69 = [
    'Potential for relationship growth',
    'Getting to know each other phase',
    'Needs a bit more effort',
    'Still exploring each other',
  ]

  const relations50to59 = [
    'One side more proactive',
    'Temperature difference in interest',
    'Communication balance needed',
    'Direction setting required',
  ]

  const relations40to49 = [
    'Passive communication pattern',
    'One-sided interest',
    'Conversation often breaks off',
    'Lacks proactivity',
  ]

  const relations0to39 = [
    'Casual acquaintance relationship',
    'Limited communication',
    'No romantic interest apparent',
    'Mostly formal conversations',
  ]

  let selectedArray: string[]

  if (score >= 90) selectedArray = relations90to100
  else if (score >= 80) selectedArray = relations80to89
  else if (score >= 70) selectedArray = relations70to79
  else if (score >= 60) selectedArray = relations60to69
  else if (score >= 50) selectedArray = relations50to59
  else if (score >= 40) selectedArray = relations40to49
  else selectedArray = relations0to39

  return selectedArray[Math.floor(Math.random() * selectedArray.length)]
}

// ëª©ì—… ê²°ê³¼ ìƒì„± í•¨ìˆ˜
function generateMockResult(p1: string, p2: string, analysis?: any, lang: SupportedLanguage = 'ko') {
  const countP1 = analysis?.participants?.[p1]?.messageCount || 100
  const countP2 = analysis?.participants?.[p2]?.messageCount || 100
  const total = countP1 + countP2
  const balance = 1 - Math.abs(countP1 - countP2) / total
  const baseScore = Math.floor(balance * 30) + 55
  const score = Math.min(95, baseScore + Math.floor(Math.random() * 15))

  const dominant = countP1 > countP2 ? p2 : p1
  const lessActive = countP1 > countP2 ? p1 : p2

  const tips = [
    `${dominant}ë‹˜ì´ ì¢‹ì•„í•˜ëŠ” ì£¼ì œë¡œ ëŒ€í™”ë¥¼ ì´ëŒì–´ë³´ì„¸ìš”. ê³µí†µ ê´€ì‹¬ì‚¬ë¥¼ ì°¾ìœ¼ë©´ ê¸‰ì§„ì „!`,
    `ë°¤ 10ì‹œ ì´í›„ ê°ì„±ì ì¸ ëŒ€í™”ë¥¼ ì‹œë„í•´ë³´ì„¸ìš”. ì´ ì‹œê°„ëŒ€ì— í˜¸ê°ë„ê°€ 2ë°°ë¡œ ì˜¬ë¼ê°‘ë‹ˆë‹¤!`,
    `ê°€ë”ì€ ë¨¼ì € ì—°ë½í•˜ì§€ ë§ê³  ê¸°ë‹¤ë ¤ë³´ì„¸ìš”. ë°€ë‹¹ì˜ ê¸°ë³¸ì€ 'ë°€ê¸°'ì…ë‹ˆë‹¤!`,
    `ì´ëª¨í‹°ì½˜ê³¼ ã…‹ã…‹ã…‹ë¥¼ ì ì ˆíˆ ì„ì–´ì„œ ì‚¬ìš©í•˜ì„¸ìš”. ë„ˆë¬´ ì§„ì§€í•˜ë©´ ë¶€ë‹´ìŠ¤ëŸ¬ì›Œí•´ìš”.`,
  ]

  // ë‹¤ì–‘í•œ ì„±í–¥ íƒ€ì… í’€ (12ê°€ì§€)
  const personalityTypes = [
    {
      type: 'ì ê·¹ì ì¸ ë¦¬ë”í˜•',
      activeTraits: ['ë¨¼ì € ëŒ€í™”ë¥¼ ì‹œì‘í•˜ëŠ” í¸', 'ì£¼ë„ì ìœ¼ë¡œ ê³„íšì„ ì„¸ì›€', 'ê²°ì •ì„ ë¹ ë¥´ê²Œ ë‚´ë¦¼'],
      passiveTraits: ['ìƒëŒ€ë°©ì„ ì˜ ë”°ë¼ì¤Œ', 'ë¦¬ë“œë¥¼ ë°›ì•„ì£¼ëŠ” í¸', 'ìœ ì—°í•˜ê²Œ ë§ì¶°ì¤Œ'],
      activeDesc: (name: string) => `${name}ë‹˜ì€ ê´€ê³„ì—ì„œ ì£¼ë„ê¶Œì„ ê°€ì§€ê³  ì´ëŒì–´ê°€ëŠ” ì ê·¹ì ì¸ ë¦¬ë”í˜•ì…ë‹ˆë‹¤. ëŒ€í™”ë¥¼ ë¨¼ì € ì‹œì‘í•˜ëŠ” ê²½ìš°ê°€ ë§ê³ , ë§Œë‚¨ì´ë‚˜ ë°ì´íŠ¸ ê³„íšì„ ì£¼ë„ì ìœ¼ë¡œ ì œì•ˆí•˜ëŠ” ê²½í–¥ì´ ìˆì–´ìš”. ìì‹ ì˜ ì˜ê²¬ì„ ëª…í™•í•˜ê³  ì†”ì§í•˜ê²Œ í‘œí˜„í•˜ë©°, ìƒëŒ€ë°©ê³¼ì˜ ê´€ê³„ë¥¼ ë°œì „ì‹œí‚¤ê¸° ìœ„í•´ ì ê·¹ì ìœ¼ë¡œ ë…¸ë ¥í•©ë‹ˆë‹¤. ê²°ì •ì„ ë‚´ë¦´ ë•Œë„ ë¹ ë¥´ê³  í™•ì‹  ìˆê²Œ í–‰ë™í•˜ë©°, ê´€ê³„ì˜ ë°©í–¥ì„±ì„ ëª…í™•íˆ í•˜ë ¤ëŠ” ì„±í–¥ì´ ê°•í•©ë‹ˆë‹¤. ë‹¤ì†Œ ì£¼ë„ì ì´ì§€ë§Œ, ìƒëŒ€ë°©ì˜ ì˜ê²¬ë„ ì¡´ì¤‘í•˜ë©° ê· í˜•ì„ ë§ì¶”ë ¤ ë…¸ë ¥í•˜ëŠ” ëª¨ìŠµì„ ë³´ì…ë‹ˆë‹¤.`,
      passiveDesc: (name: string) => `${name}ë‹˜ì€ ìƒëŒ€ë°©ì˜ í˜ì´ìŠ¤ì— ë§ì¶° í¸ì•ˆí•œ ê´€ê³„ë¥¼ ë§Œë“¤ì–´ê°€ëŠ” ìœ ì—°í•œ ìŠ¤íƒ€ì¼ì…ë‹ˆë‹¤. ë¬´ë¦¬í•˜ê²Œ ê´€ê³„ë¥¼ ë°€ì–´ë¶™ì´ì§€ ì•Šê³ , ìì—°ìŠ¤ëŸ¬ìš´ íë¦„ì— ëª¸ì„ ë§¡ê¸°ëŠ” ê²ƒì„ ì„ í˜¸í•´ìš”. ìƒëŒ€ë°©ì´ ì£¼ë„í•  ë•Œ ì˜ ë”°ë¼ì£¼ê³ , ë¦¬ë“œë¥¼ ë°›ì•„ì£¼ëŠ” ê²ƒì— ê±°ë¶€ê°ì´ ì—†ìœ¼ë©°, ì˜¤íˆë ¤ ê·¸ëŸ° ê´€ê³„ê°€ í¸ì•ˆí•˜ë‹¤ê³  ëŠë‚ë‹ˆë‹¤. ê°ˆë“± ìƒí™©ì—ì„œë„ ë§ì„œê¸°ë³´ë‹¤ëŠ” ìœ ì—°í•˜ê²Œ ëŒ€ì²˜í•˜ë©°, ìƒëŒ€ë°©ì˜ ê¸°ë¶„ê³¼ ìƒí™©ì„ ê³ ë ¤í•´ ìì‹ ì„ ë§ì¶”ëŠ” ê²½í–¥ì´ ìˆì–´ìš”. ê´€ê³„ì˜ ì•ˆì •ì„±ê³¼ í¸ì•ˆí•¨ì„ ì¤‘ì‹œí•˜ëŠ” ì„±í–¥ì…ë‹ˆë‹¤.`
    },
    {
      type: 'ê°ì„±ì ì¸ ë¡œë§¨í‹°ìŠ¤íŠ¸',
      activeTraits: ['ê°ì • í‘œí˜„ì´ í’ë¶€í•¨', 'ë¶„ìœ„ê¸°ë¥¼ ì¤‘ì‹œí•¨', 'íŠ¹ë³„í•œ ìˆœê°„ì„ ë§Œë“¦'],
      passiveTraits: ['ê°ìˆ˜ì„±ì´ í’ë¶€í•¨', 'ìƒëŒ€ë°©ì˜ ê°ì •ì— ê³µê°í•¨', 'ì€ì€í•œ í‘œí˜„ì„ ì„ í˜¸í•¨'],
      activeDesc: (name: string) => `${name}ë‹˜ì€ ë¡œë§¨í‹±í•œ ìˆœê°„ê³¼ ê°ì„±ì ì¸ êµê°ì„ ì¤‘ìš”í•˜ê²Œ ì—¬ê¸°ëŠ” ê°ì„±íŒŒì…ë‹ˆë‹¤. ëŒ€í™”í•  ë•Œ ê°ì • í‘œí˜„ì´ í’ë¶€í•˜ê³ , ë¶„ìœ„ê¸°ë¥¼ ì¤‘ì‹œí•˜ë©° íŠ¹ë³„í•œ ìˆœê°„ì„ ë§Œë“¤ì–´ë‚´ëŠ” ë° ê´€ì‹¬ì´ ë§ì•„ìš”. ìƒëŒ€ë°©ì—ê²Œ ì‘ì€ ì„ ë¬¼ì´ë‚˜ ë”°ëœ»í•œ ë§ë¡œ ê°ë™ì„ ì£¼ë ¤ í•˜ë©°, ê°ì„±ì ì¸ ë©”ì‹œì§€ë‚˜ ì´ëª¨í‹°ì½˜ì„ ìì£¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ê´€ê³„ì—ì„œ ê¹Šì´ì™€ ì˜ë¯¸ë¥¼ ì¶”êµ¬í•˜ë©°, í”¼ìƒì ì¸ ë§Œë‚¨ë³´ë‹¤ëŠ” ì§„ì‹¬ ì–´ë¦° êµê°ì„ ì›í•´ìš”. ë•Œë¡œëŠ” ë„ˆë¬´ ê°ì„±ì ì´ì–´ì„œ ìƒì²˜ë°›ê¸° ì‰½ì§€ë§Œ, ê·¸ë§Œí¼ ìƒëŒ€ë°©ì—ê²Œ ì§„ì‹¬ì„ ë‹¤í•˜ëŠ” ì„±í–¥ì…ë‹ˆë‹¤.`,
      passiveDesc: (name: string) => `${name}ë‹˜ì€ ì¡°ìš©íˆ ê°ì •ì„ ëŠë¼ê³  í‘œí˜„í•˜ëŠ” ì„¬ì„¸í•œ ê°ì„±íŒŒì…ë‹ˆë‹¤. ì‘ì€ ê²ƒì—ì„œë„ ì˜ë¯¸ë¥¼ ì°¾ê³ , ì§„ì‹¬ ì–´ë¦° êµê°ì„ ì†Œì¤‘íˆ ì—¬ê¸°ë©°, ìƒëŒ€ë°©ì˜ ê°ì • ë³€í™”ì— ë¯¼ê°í•˜ê²Œ ë°˜ì‘í•´ìš”. ëŒ€í™”í•  ë•Œ ê³µê° ëŠ¥ë ¥ì´ ë›°ì–´ë‚˜ë©°, ìƒëŒ€ë°©ì˜ ê¸°ë¶„ì„ ì˜ í—¤ì•„ë¦¬ê³  ë§ì¶°ì£¼ëŠ” í¸ì…ë‹ˆë‹¤. ì€ì€í•˜ê³  ì„¬ì„¸í•œ í‘œí˜„ì„ ì„ í˜¸í•˜ë©°, ê³¼ë„í•˜ê²Œ ë“œëŸ¬ë‚´ê¸°ë³´ë‹¤ëŠ” ì¡°ìš©íˆ ë§ˆìŒì„ ì „ë‹¬í•˜ëŠ” ë°©ì‹ì„ íƒí•´ìš”. ê°ìˆ˜ì„±ì´ í’ë¶€í•´ ìƒëŒ€ë°©ì˜ ì‘ì€ ë°°ë ¤ì—ë„ í¬ê²Œ ê°ë™í•˜ê³ , ê·¸ ë§ˆìŒì„ ì˜¤ë˜ ê¸°ì–µí•©ë‹ˆë‹¤.`
    },
    {
      type: 'ë°ì€ ì—ë„ˆìì´ì €',
      activeTraits: ['ê¸ì • ì—ë„ˆì§€ê°€ ë„˜ì¹¨', 'ì¬ë¯¸ìˆëŠ” ëŒ€í™”ë¥¼ ì´ë”', 'ë¶„ìœ„ê¸°ë¥¼ ë°ê²Œ ë§Œë“¦'],
      passiveTraits: ['ë°ì€ ì—ë„ˆì§€ë¥¼ ë°›ì•„ì¤Œ', 'í•¨ê»˜ ì›ƒê³  ì¦ê¹€', 'ê¸ì •ì ìœ¼ë¡œ ë°˜ì‘í•¨'],
      activeDesc: (name: string) => `${name}ë‹˜ì€ ì£¼ë³€ì„ ë°ê²Œ ë§Œë“œëŠ” ê¸ì • ì—ë„ˆì§€ê°€ ë„˜ì¹˜ëŠ” ì—ë„ˆìì´ì €ì…ë‹ˆë‹¤. ëŒ€í™”í•  ë•Œ í™œê¸°ì°¨ê³  ì¬ë¯¸ìˆëŠ” ì´ì•¼ê¸°ë¥¼ ì˜ êº¼ë‚´ë©°, ë¶„ìœ„ê¸°ë¥¼ ë„ìš°ëŠ” ëŠ¥ë ¥ì´ íƒì›”í•´ìš”. ì´ëª¨í‹°ì½˜ê³¼ ã…‹ã…‹ã…‹ë¥¼ ë§ì´ ì‚¬ìš©í•˜ë©°, ìƒëŒ€ë°©ì´ í˜ë“¤ ë•Œë„ ê¸ì •ì ì¸ ì—ë„ˆì§€ë¡œ ê¸°ìš´ì„ ë¶ë‹ì•„ì¤ë‹ˆë‹¤. í•¨ê»˜ ìˆìœ¼ë©´ ì‹œê°„ì´ ë¹ ë¥´ê²Œ ê°€ê³ , ì›ƒìŒì´ ëŠì´ì§€ ì•ŠëŠ” ì¦ê±°ìš´ ë¶„ìœ„ê¸°ë¥¼ ë§Œë“¤ì–´ìš”. ë•Œë¡œëŠ” ì§„ì§€í•œ ìˆœê°„ì—ë„ ìœ ë¨¸ë¥¼ ì„ì–´ ë¶€ë‹´ì„ ëœì–´ì£¼ë©°, ê´€ê³„ë¥¼ ê°€ë³ê³  ì¦ê²ê²Œ ìœ ì§€í•˜ëŠ” ë° íƒì›”í•œ ëŠ¥ë ¥ì„ ë³´ì…ë‹ˆë‹¤.`,
      passiveDesc: (name: string) => `${name}ë‹˜ì€ ìƒëŒ€ë°©ì˜ ë°ì€ ì—ë„ˆì§€ë¥¼ ì˜ ë°›ì•„ì£¼ê³  í•¨ê»˜ ì¦ê¸°ëŠ” ìŠ¤íƒ€ì¼ì…ë‹ˆë‹¤. ê¸ì •ì ìœ¼ë¡œ ë°˜ì‘í•˜ë©° ë¦¬ì•¡ì…˜ì´ ì¢‹ì•„ì„œ, ìƒëŒ€ë°©ì´ ì´ì•¼ê¸°í•˜ëŠ” ì¬ë¯¸ë¥¼ ëŠë¼ê²Œ ë§Œë“¤ì–´ìš”. í•¨ê»˜ ì›ƒê³  ì¦ê¸°ëŠ” ê²ƒì„ ì¢‹ì•„í•˜ë©°, ë¬´ê±°ìš´ ë¶„ìœ„ê¸°ë³´ë‹¤ëŠ” ê°€ë²¼ìš´ ëŒ€í™”ë¥¼ ì„ í˜¸í•©ë‹ˆë‹¤. ìƒëŒ€ë°©ì˜ ë†ë‹´ì— ì˜ ì›ƒì–´ì£¼ê³ , ã…‹ã…‹ã…‹ë¡œ í™œë°œí•˜ê²Œ ë°˜ì‘í•˜ë©° ëŒ€í™”ì— ìƒê¸°ë¥¼ ë”í•´ìš”. í¸ì•ˆí•˜ê³  ê¸ì •ì ì¸ ë¶„ìœ„ê¸° ì†ì—ì„œ ìì—°ìŠ¤ëŸ½ê²Œ ê´€ê³„ë¥¼ ë°œì „ì‹œì¼œ ë‚˜ê°€ë©°, ìŠ¤íŠ¸ë ˆìŠ¤ ì—†ì´ ì¦ê±°ìš´ ì‹œê°„ì„ ë³´ë‚´ëŠ” ê²ƒì„ ì¤‘ì‹œí•©ë‹ˆë‹¤.`
    },
    {
      type: 'ì‹ ì¤‘í•œ ë¶„ì„ê°€',
      activeTraits: ['ìƒê°ì´ ê¹ŠìŒ', 'ì‹ ì¤‘í•˜ê²Œ íŒë‹¨í•¨', 'ê´€ì°°ë ¥ì´ ë›°ì–´ë‚¨'],
      passiveTraits: ['ê²½ì²­ì„ ì˜í•¨', 'ìƒí™©ì„ íŒŒì•…í•¨', 'ì¹¨ì°©í•˜ê²Œ ëŒ€ì‘í•¨'],
      activeDesc: (name: string) => `${name}ë‹˜ì€ ê´€ê³„ë¥¼ ì‹ ì¤‘í•˜ê²Œ ë¶„ì„í•˜ê³  ë°œì „ì‹œì¼œë‚˜ê°€ëŠ” ì‚¬ê³ í˜• ìŠ¤íƒ€ì¼ì…ë‹ˆë‹¤. ëŒ€í™”í•  ë•Œ ìƒê°ì´ ê¹Šê³ , ìƒëŒ€ë°©ì˜ ë§ê³¼ í–‰ë™ì„ ì£¼ì˜ ê¹Šê²Œ ê´€ì°°í•˜ë©° ì˜ë¯¸ë¥¼ íŒŒì•…í•˜ë ¤ ë…¸ë ¥í•´ìš”. ì¦‰í¥ì ì¸ ê²°ì •ë³´ë‹¤ëŠ” ì¶©ë¶„íˆ ê³ ë¯¼í•œ í›„ ì‹ ì¤‘í•˜ê²Œ í–‰ë™í•˜ë©°, ê´€ì°°ë ¥ì´ ë›°ì–´ë‚˜ ìƒëŒ€ë°©ì˜ ìˆ¨ì€ ì˜ë„ë‚˜ ê°ì •ê¹Œì§€ ì½ì–´ëƒ…ë‹ˆë‹¤. ê¹Šì´ ìˆëŠ” ëŒ€í™”ë¥¼ ì„ í˜¸í•˜ë©°, í”¼ìƒì ì¸ ë§Œë‚¨ë³´ë‹¤ëŠ” ì§„ì§€í•˜ê³  ì˜ë¯¸ ìˆëŠ” êµë¥˜ë¥¼ ì¶”êµ¬í•´ìš”. ë¶„ì„ì ì¸ ì„±í–¥ ë•Œë¬¸ì— ë•Œë¡œëŠ” ê³ ë¯¼ì´ ë§ì§€ë§Œ, ê·¸ë§Œí¼ ì‹ ì¤‘í•˜ê³  ì•ˆì •ì ì¸ ê´€ê³„ë¥¼ ë§Œë“¤ì–´ê°‘ë‹ˆë‹¤.`,
      passiveDesc: (name: string) => `${name}ë‹˜ì€ ì°¨ë¶„í•˜ê²Œ ìƒí™©ì„ ê´€ì°°í•˜ë©° ëŒ€ì‘í•˜ëŠ” ì¹¨ì°©í•œ ìŠ¤íƒ€ì¼ì…ë‹ˆë‹¤. ê²½ì²­ì„ ì˜í•˜ë©°, ìƒëŒ€ë°©ì˜ ë§ì„ ëê¹Œì§€ ë“¤ì–´ì£¼ê³  ìƒí™©ì„ ì •í™•íˆ íŒŒì•…í•˜ëŠ” ëŠ¥ë ¥ì´ ìˆì–´ìš”. ê¸‰í•˜ê²Œ ì„œë‘ë¥´ì§€ ì•Šê³  ê´€ê³„ê°€ ìì—°ìŠ¤ëŸ½ê²Œ ìµì–´ê°€ê¸¸ ê¸°ë‹¤ë¦¬ë©°, ì„±ê¸‰í•œ íŒë‹¨ì´ë‚˜ í–‰ë™ì„ ì§€ì–‘í•©ë‹ˆë‹¤. ìƒëŒ€ë°©ì˜ í˜ì´ìŠ¤ë¥¼ ì¡´ì¤‘í•˜ê³  ë§ì¶°ì£¼ëŠ” í¸ì´ë©°, ì•ˆì •ì ì´ê³  ì˜ˆì¸¡ ê°€ëŠ¥í•œ ê´€ê³„ë¥¼ ì„ í˜¸í•´ìš”. ê°ˆë“± ìƒí™©ì—ì„œë„ ê°ì •ì ìœ¼ë¡œ ë°˜ì‘í•˜ê¸°ë³´ë‹¤ëŠ” ì¹¨ì°©í•˜ê²Œ ëŒ€ì²˜í•˜ë©°, ë…¼ë¦¬ì ì´ê³  í•©ë¦¬ì ì¸ í•´ê²°ì±…ì„ ì°¾ìœ¼ë ¤ ë…¸ë ¥í•©ë‹ˆë‹¤.`
    },
    {
      type: 'ë”°ëœ»í•œ ê³µê°í˜•',
      activeTraits: ['ê³µê° ëŠ¥ë ¥ì´ ë›°ì–´ë‚¨', 'ìœ„ë¡œë¥¼ ì˜í•¨', 'ë°°ë ¤ì‹¬ì´ ë§ìŒ'],
      passiveTraits: ['ê°ì •ì„ ì˜ ì½ìŒ', 'ì¡°ìš©íˆ ì§€ì§€í•¨', 'í¸ì•ˆí•¨ì„ ì¤Œ'],
      activeDesc: (name: string) => `${name}ë‹˜ì€ ìƒëŒ€ë°©ì˜ ë§ˆìŒì„ ì˜ í—¤ì•„ë¦¬ëŠ” ë”°ëœ»í•œ ê³µê°í˜•ì…ë‹ˆë‹¤. ê³µê° ëŠ¥ë ¥ì´ ë›°ì–´ë‚˜ ìƒëŒ€ë°©ì˜ ê°ì •ì„ ë¹ ë¥´ê²Œ ì´í•´í•˜ê³ , í•„ìš”í•œ ìˆœê°„ì— ì§„ì‹¬ ì–´ë¦° ìœ„ë¡œì™€ ê²©ë ¤ë¥¼ ê±´ë„¤ìš”. ë°°ë ¤ì‹¬ì´ ë§ì•„ ìƒëŒ€ë°©ì´ ë¶ˆí¸í•˜ì§€ ì•Šë„ë¡ ì„¸ì‹¬í•˜ê²Œ ì‹ ê²½ ì“°ë©°, ì‘ì€ ê²ƒ í•˜ë‚˜ê¹Œì§€ ì±™ê¸°ëŠ” ëª¨ìŠµì„ ë³´ì…ë‹ˆë‹¤. ëŒ€í™”í•  ë•Œ ìƒëŒ€ë°©ì˜ ê³ ë¯¼ì„ ì˜ ë“¤ì–´ì£¼ê³ , ê³µê°í•˜ëŠ” ë§ì„ ë§ì´ í•˜ë©° ì •ì„œì  ì•ˆì •ê°ì„ ì œê³µí•´ìš”. ë‹¤ë¥¸ ì‚¬ëŒì˜ ì•„í””ì— ë¯¼ê°í•˜ê²Œ ë°˜ì‘í•˜ë©°, í˜ì´ ë˜ì–´ì£¼ê³  ì‹¶ì–´í•˜ëŠ” ë”°ëœ»í•œ ë§ˆìŒì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.`,
      passiveDesc: (name: string) => `${name}ë‹˜ì€ ë§ì—†ì´ë„ ìƒëŒ€ë°©ì˜ ê°ì •ì„ ì´í•´í•˜ëŠ” ì„¬ì„¸í•œ ê³µê°í˜•ì…ë‹ˆë‹¤. ì¡°ìš©íˆ ì§€ì§€í•´ì£¼ë©°, ê³ì— ìˆëŠ” ê²ƒë§Œìœ¼ë¡œë„ ì•ˆì •ê°ì„ ì£¼ëŠ” ì¡´ì¬ì˜ˆìš”. ìƒëŒ€ë°©ì˜ ê°ì •ì„ ì˜ ì½ê³ , í¸ì•ˆí•œ ë¶„ìœ„ê¸°ë¥¼ ë§Œë“¤ì–´ì£¼ë©°, í•„ìš”í•  ë•Œ ì¡°ìš©íˆ ë‹¤ê°€ê°€ ìœ„ë¡œë¥¼ ê±´ë„µë‹ˆë‹¤. ê³¼ë„í•˜ê²Œ ê°„ì„­í•˜ê±°ë‚˜ ì¡°ì–¸í•˜ê¸°ë³´ë‹¤ëŠ”, ìƒëŒ€ë°©ì´ ì›í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì§€ì§€í•´ì£¼ëŠ” ê²ƒì„ ì„ í˜¸í•´ìš”. ê°ì •ì ìœ¼ë¡œ ì•ˆì •ì ì´ê³  í¸ì•ˆí•œ ì¡´ì¬ë¡œ ì¸ì‹ë˜ë©°, í•¨ê»˜ ìˆìœ¼ë©´ ë§ˆìŒì´ í¸í•´ì§€ëŠ” ì‚¬ëŒì…ë‹ˆë‹¤. ë°°ë ¤ì‹¬ì´ ê¹Šì–´ ìƒëŒ€ë°©ì˜ ì‘ì€ ë¶ˆí¸í•¨ë„ ë†“ì¹˜ì§€ ì•Šê³  ì±™ê²¨ì¤ë‹ˆë‹¤.`
    },
    {
      type: 'ìœ ë¨¸ëŸ¬ìŠ¤í•œ ë¶„ìœ„ê¸°ë©”ì´ì»¤',
      activeTraits: ['ì›ƒìŒ ì½”ë“œê°€ ì˜ ë§ìŒ', 'ì¬ì¹˜ìˆëŠ” í‘œí˜„ì„ í•¨', 'ì¦ê±°ìš´ ë¶„ìœ„ê¸° ì¡°ì„±'],
      passiveTraits: ['ìœ ë¨¸ë¥¼ ì˜ ë°›ì•„ì¤Œ', 'ã…‹ã…‹ã…‹ë¥¼ ë§ì´ ì”€', 'ê°™ì´ ì¦ê±°ì›Œí•¨'],
      activeDesc: (name: string) => `${name}ë‹˜ì€ ìœ ë¨¸ì™€ ì¬ì¹˜ë¡œ ê´€ê³„ë¥¼ ì¦ê²ê²Œ ë§Œë“œëŠ” ë¶„ìœ„ê¸°ë©”ì´ì»¤ì…ë‹ˆë‹¤. ì›ƒìŒ ì½”ë“œê°€ ì˜ ë§ê³ , ì¬ì¹˜ìˆëŠ” í‘œí˜„ìœ¼ë¡œ ëŒ€í™”ë¥¼ ì¬ë¯¸ìˆê²Œ ì´ëŒì–´ê°€ëŠ” ëŠ¥ë ¥ì´ íƒì›”í•´ìš”. ì–´ìƒ‰í•œ ë¶„ìœ„ê¸°ë¥¼ ìˆœì‹ê°„ì— í’€ì–´ë²„ë¦¬ë©°, ë¬´ê±°ìš´ ìˆœê°„ì—ë„ ì ì ˆí•œ ìœ ë¨¸ë¡œ ê¸´ì¥ì„ ì™„í™”ì‹œí‚µë‹ˆë‹¤. ëŒ€í™”ê°€ ëŠì´ì§€ ì•Šë„ë¡ ì¬ë¯¸ìˆëŠ” ì´ì•¼ê¸°ê±°ë¦¬ë¥¼ ì˜ ì°¾ì•„ë‚´ë©°, ìƒëŒ€ë°©ì„ ì›ƒê²Œ ë§Œë“œëŠ” ê²ƒì—ì„œ ì¦ê±°ì›€ì„ ëŠê»´ìš”. í•¨ê»˜ ìˆìœ¼ë©´ ì›ƒìŒì´ ëŠì´ì§€ ì•Šê³ , ì‹œê°„ ê°€ëŠ” ì¤„ ëª¨ë¥´ê²Œ ì¦ê±°ìš´ ì‹œê°„ì„ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê´€ê³„ë¥¼ ê°€ë³ê³  ì¦ê²ê²Œ ìœ ì§€í•˜ëŠ” ë° íƒì›”í•œ ì¬ëŠ¥ì´ ìˆìŠµë‹ˆë‹¤.`,
      passiveDesc: (name: string) => `${name}ë‹˜ì€ ìƒëŒ€ë°©ì˜ ìœ ë¨¸ë¥¼ ì˜ ë°›ì•„ì£¼ë©° í•¨ê»˜ ì¦ê¸°ëŠ” ë°˜ì‘í˜• ìŠ¤íƒ€ì¼ì…ë‹ˆë‹¤. ë¦¬ì•¡ì…˜ì´ ë§¤ìš° ì¢‹ì•„ì„œ ëŒ€í™” ìƒëŒ€ê°€ ì´ì•¼ê¸°í•˜ëŠ” ì¬ë¯¸ë¥¼ ëŠë¼ê²Œ ë§Œë“¤ê³ , ã…‹ã…‹ã…‹ë¥¼ ë§ì´ ì‚¬ìš©í•´ ê¸ì •ì ì¸ ì—ë„ˆì§€ë¥¼ ì „ë‹¬í•´ìš”. ìƒëŒ€ë°©ì˜ ë†ë‹´ì— ì§„ì‹¬ìœ¼ë¡œ ì›ƒì–´ì£¼ê³ , í•¨ê»˜ ì¦ê±°ì›Œí•˜ë©° ë¶„ìœ„ê¸°ë¥¼ ë°ê²Œ ë§Œë“­ë‹ˆë‹¤. ìœ ë¨¸ ê°ê°ì´ ìˆì–´ ì ì ˆí•œ íƒ€ì´ë°ì— ì¬ì¹˜ìˆëŠ” ë°˜ì‘ì„ ë³´ì´ë©°, ëŒ€í™”ë¥¼ ë”ìš± ì¬ë¯¸ìˆê²Œ ë§Œë“¤ì–´ìš”. ê°€ë²¼ìš´ ë¶„ìœ„ê¸°ë¥¼ ì¦ê¸°ê³ , ì›ƒìŒì´ ìˆëŠ” ê´€ê³„ë¥¼ ì„ í˜¸í•˜ë©°, í•¨ê»˜ ìˆìœ¼ë©´ ìì—°ìŠ¤ëŸ½ê²Œ ê¸°ë¶„ì´ ì¢‹ì•„ì§€ëŠ” ì‚¬ëŒì…ë‹ˆë‹¤.`
    },
    {
      type: 'ì¿¨í•œ ë…ë¦½í˜•',
      activeTraits: ['ìê¸°ë§Œì˜ ê³µê°„ì„ ì¤‘ì‹œí•¨', 'ë…ë¦½ì ì¸ ì„±í–¥', 'ì ì ˆí•œ ê±°ë¦¬ ìœ ì§€'],
      passiveTraits: ['ìƒëŒ€ë°©ì˜ ììœ ë¥¼ ì¡´ì¤‘í•¨', 'ì§‘ì°©í•˜ì§€ ì•ŠìŒ', 'ì—¬ìœ ë¡œìš´ íƒœë„'],
      activeDesc: (name: string) => `${name}ë‹˜ì€ ìì‹ ë§Œì˜ ì‹œê°„ê³¼ ê³µê°„ì„ ì†Œì¤‘íˆ ì—¬ê¸°ëŠ” ë…ë¦½ì ì¸ ì¿¨ê°€ì´/ê±¸ì…ë‹ˆë‹¤. ê´€ê³„ì—ì„œë„ ì ì ˆí•œ ê±°ë¦¬ê°ì„ ìœ ì§€í•˜ë©°, ì„œë¡œì˜ ììœ ì™€ ê°œì¸ ì‹œê°„ì„ ì¡´ì¤‘í•˜ëŠ” ê²ƒì„ ì¤‘ìš”í•˜ê²Œ ìƒê°í•´ìš”. ë§¤ì¼ ë¶™ì–´ìˆê¸°ë³´ë‹¤ëŠ” ê°ìì˜ ìƒí™œì„ ìœ ì§€í•˜ë©´ì„œ ë§Œë‚  ë•Œ ë”ìš± ì¦ê²ê²Œ ë§Œë‚˜ëŠ” ìŠ¤íƒ€ì¼ì„ ì„ í˜¸í•©ë‹ˆë‹¤. ì§‘ì°©í•˜ì§€ ì•Šê³  ì—¬ìœ ë¡œìš´ íƒœë„ë¥¼ ë³´ì´ë©°, ìƒëŒ€ë°©ì—ê²Œ ë¶€ë‹´ì„ ì£¼ì§€ ì•Šìœ¼ë ¤ ë…¸ë ¥í•´ìš”. ë…ë¦½ì ì¸ ì„±í–¥ ë•Œë¬¸ì— ë•Œë¡œëŠ” ëƒ‰ì •í•´ ë³´ì¼ ìˆ˜ ìˆì§€ë§Œ, ì‹¤ì œë¡œëŠ” ê±´ê°•í•˜ê³  ì„±ìˆ™í•œ ê´€ê³„ë¥¼ ì¶”êµ¬í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.`,
      passiveDesc: (name: string) => `${name}ë‹˜ì€ ìƒëŒ€ë°©ì—ê²Œ ì§‘ì°©í•˜ì§€ ì•Šê³  ì—¬ìœ ë¡œìš´ ê´€ê³„ë¥¼ ì¶”êµ¬í•˜ëŠ” ì¿¨í•œ ìŠ¤íƒ€ì¼ì…ë‹ˆë‹¤. ìƒëŒ€ë°©ì˜ ììœ ë¥¼ ì¡´ì¤‘í•˜ë©°, ì„œë¡œì˜ ê°œì¸ ì‹œê°„ì„ ì¸ì •í•˜ê³  ê±´ê°•í•œ ê±°ë¦¬ë¥¼ ìœ ì§€í•´ìš”. ë‹µì¥ì´ ëŠ¦ì–´ë„ ì¬ì´‰í•˜ì§€ ì•Šê³ , ë§Œë‚¨ì„ ê°•ìš”í•˜ì§€ ì•Šìœ¼ë©°, ìƒëŒ€ë°©ì˜ í˜ì´ìŠ¤ë¥¼ ì´í•´í•˜ê³  ë§ì¶°ì¤ë‹ˆë‹¤. ë¶€ë‹´ìŠ¤ëŸ¬ìš´ ê´€ê³„ë³´ë‹¤ëŠ” ê°€ë³ê³  í¸ì•ˆí•œ ê´€ê³„ë¥¼ ì„ í˜¸í•˜ë©°, ê°ìì˜ ìƒí™œì„ ì¡´ì¤‘í•˜ëŠ” ê²ƒì„ ë‹¹ì—°í•˜ê²Œ ì—¬ê²¨ìš”. ì—¬ìœ ë¡œìš´ íƒœë„ ë•Œë¬¸ì— ë¬´ê´€ì‹¬í•´ ë³´ì¼ ìˆ˜ ìˆì§€ë§Œ, ì‹¤ì œë¡œëŠ” ì„±ìˆ™í•˜ê³  ê±´ê°•í•œ ê´€ê³„ ë°©ì‹ì„ ì¶”êµ¬í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.`
    },
    {
      type: 'í—Œì‹ ì ì¸ ì¼€ì–´í˜•',
      activeTraits: ['ìƒëŒ€ë°©ì„ ì„¸ì‹¬í•˜ê²Œ ì±™ê¹€', 'í—Œì‹ ì ì¸ íƒœë„', 'ë°°ë ¤ê°€ ëª¸ì— ë°´ ìŠ¤íƒ€ì¼'],
      passiveTraits: ['ì¡°ìš©íˆ ì‹ ê²½ì”€', 'í•„ìš”í•  ë•Œ ë„ì›€ì„ ì¤Œ', 'ì€ê·¼íˆ ì±™ê¸°ëŠ” í¸'],
      activeDesc: (name: string) => `${name}ë‹˜ì€ ìƒëŒ€ë°©ì„ ìœ„í•´ í—Œì‹ í•˜ê³  ì„¸ì‹¬í•˜ê²Œ ì±™ê¸°ëŠ” ì¼€ì–´í˜• ìŠ¤íƒ€ì¼ì…ë‹ˆë‹¤. ë°°ë ¤ê°€ ëª¸ì— ë°°ì–´ ìˆì–´ ì‘ì€ ë¶€ë¶„ê¹Œì§€ ì‹ ê²½ ì“°ë©°, ìƒëŒ€ë°©ì´ í¸ì•ˆí•˜ê³  í–‰ë³µí•˜ë„ë¡ ìµœì„ ì„ ë‹¤í•´ìš”. ì‹ì‚¬ëŠ” í–ˆëŠ”ì§€, ì˜ ë“¤ì–´ê°”ëŠ”ì§€, í”¼ê³¤í•˜ì§€ ì•Šì€ì§€ ë“± ì‚¬ì†Œí•œ ê²ƒê¹Œì§€ ì±™ê¸°ë©° ê´€ì‹¬ì„ í‘œí˜„í•©ë‹ˆë‹¤. ìƒëŒ€ë°©ì˜ í•„ìš”ë¥¼ ë¨¼ì € íŒŒì•…í•˜ê³  ë„ì›€ì„ ì œê³µí•˜ë©°, ë•Œë¡œëŠ” ìì‹ ì˜ ì¼ë³´ë‹¤ ìƒëŒ€ë°©ì„ ìš°ì„ ì‹œí•˜ëŠ” ê²½í–¥ì´ ìˆì–´ìš”. í—Œì‹ ì ì¸ íƒœë„ë¡œ ê´€ê³„ì— ê¹Šì´ íˆ¬ìí•˜ë©°, ìƒëŒ€ë°©ì´ ì•ˆì •ê°ê³¼ ì‚¬ë‘ì„ ëŠë‚„ ìˆ˜ ìˆë„ë¡ ë…¸ë ¥í•©ë‹ˆë‹¤.`,
      passiveDesc: (name: string) => `${name}ë‹˜ì€ í‹° ë‚´ì§€ ì•Šê³  ì¡°ìš©íˆ ìƒëŒ€ë°©ì„ ë°°ë ¤í•˜ëŠ” ì€ê·¼í•œ ì¼€ì–´í˜•ì…ë‹ˆë‹¤. í•„ìš”í•œ ìˆœê°„ì— ì€ê·¼íˆ ì±™ê²¨ì£¼ë©° ì•ˆì •ê°ì„ ì œê³µí•˜ê³ , ê³¼ë„í•˜ê²Œ ë“œëŸ¬ë‚´ì§€ ì•Šì§€ë§Œ í•­ìƒ ì‹ ê²½ ì“°ê³  ìˆì–´ìš”. ìƒëŒ€ë°©ì´ í˜ë“¤ ë•Œ ì¡°ìš©íˆ ë‹¤ê°€ê°€ ë„ì›€ì„ ì£¼ê³ , ë¶€ë‹´ìŠ¤ëŸ½ì§€ ì•Šì€ ì„ ì—ì„œ ë°°ë ¤ë¥¼ í‘œí˜„í•©ë‹ˆë‹¤. ë§ë³´ë‹¤ëŠ” í–‰ë™ìœ¼ë¡œ ë§ˆìŒì„ ì „ë‹¬í•˜ë©°, ì‘ì€ ë°°ë ¤ê°€ ìŒ“ì—¬ í° ê°ë™ì„ ì£¼ëŠ” ìŠ¤íƒ€ì¼ì´ì—ìš”. ìƒëŒ€ë°©ì´ í¸ì•ˆí•˜ê²Œ ëŠë‚„ ìˆ˜ ìˆë„ë¡ ì„¸ì‹¬í•˜ê²Œ ì‹ ê²½ ì“°ë©°, ì¡°ìš©íˆ ì§€ì§€í•´ì£¼ëŠ” ë“ ë“ í•œ ì¡´ì¬ì…ë‹ˆë‹¤.`
    },
    {
      type: 'ì§„ì§€í•œ ëŒ€í™”í˜•',
      activeTraits: ['ê¹Šì´ ìˆëŠ” ëŒ€í™”ë¥¼ ì„ í˜¸í•¨', 'ì§„ì§€í•œ ì£¼ì œë¥¼ ì¦ê¹€', 'ì˜ë¯¸ ìˆëŠ” êµë¥˜ ì¶”êµ¬'],
      passiveTraits: ['ì§„ì§€í•œ ë¶„ìœ„ê¸°ì— ì˜ ë§ì¶¤', 'ê¹Šì€ ìƒê°ì„ ë‚˜ëˆ”', 'í‘œë©´ì  ëŒ€í™” ì§€ì–‘'],
      activeDesc: (name: string) => `${name}ë‹˜ì€ ê°€ë²¼ìš´ ëŒ€í™”ë³´ë‹¤ ê¹Šì´ ìˆê³  ì§„ì§€í•œ ì£¼ì œë¥¼ ì¦ê¸°ëŠ” ì§€ì ì¸ ëŒ€í™”í˜•ì…ë‹ˆë‹¤. ì„œë¡œì˜ ìƒê°ê³¼ ê°€ì¹˜ê´€, ì² í•™ì„ ë‚˜ëˆ„ë©° ì˜ë¯¸ ìˆëŠ” êµë¥˜ë¥¼ ì¶”êµ¬í•˜ê³ , í‘œë©´ì ì¸ ì¡ë‹´ë³´ë‹¤ëŠ” ë³¸ì§ˆì ì¸ ì´ì•¼ê¸°ë¥¼ ì„ í˜¸í•´ìš”. ëŒ€í™”í•  ë•Œ ì§„ì§€í•˜ê²Œ ê²½ì²­í•˜ë©°, ìƒëŒ€ë°©ì˜ ì˜ê²¬ì„ ê¹Šì´ ìˆê²Œ íƒêµ¬í•˜ê³  ì´í•´í•˜ë ¤ ë…¸ë ¥í•©ë‹ˆë‹¤. ì§€ì  í˜¸ê¸°ì‹¬ì´ ë§ì•„ ë‹¤ì–‘í•œ ì£¼ì œì— ê´€ì‹¬ì´ ìˆê³ , í† ë¡ ì´ë‚˜ ê¹Šì€ ëŒ€í™”ë¥¼ í†µí•´ ìƒëŒ€ë°©ê³¼ ë” ê°€ê¹Œì›Œì§€ê¸¸ ì›í•´ìš”. ê°€ë²¼ìš´ ê´€ê³„ë³´ë‹¤ëŠ” ì •ì‹ ì ìœ¼ë¡œ êµê°í•  ìˆ˜ ìˆëŠ” ê¹Šì´ ìˆëŠ” ê´€ê³„ë¥¼ ì¤‘ì‹œí•©ë‹ˆë‹¤.`,
      passiveDesc: (name: string) => `${name}ë‹˜ì€ ì§„ì§€í•œ ëŒ€í™” ë¶„ìœ„ê¸°ì— ì˜ ë§ì¶°ì£¼ê³  ê¹Šì€ ìƒê°ì„ ë‚˜ëˆ„ëŠ” ìŠ¤íƒ€ì¼ì…ë‹ˆë‹¤. í‘œë©´ì ì¸ ëŒ€í™”ë³´ë‹¤ ì˜ë¯¸ ìˆëŠ” ì£¼ì œë¥¼ ì„ í˜¸í•˜ë©°, ìƒëŒ€ë°©ì˜ ê¹Šì€ ì´ì•¼ê¸°ì— ì˜ ë°˜ì‘í•˜ê³  ê³µê°í•´ìš”. ê°€ë²¼ìš´ ì¡ë‹´ë³´ë‹¤ëŠ” ì„œë¡œì˜ ê°€ì¹˜ê´€ì´ë‚˜ ìƒê°ì„ ë‚˜ëˆ„ëŠ” ëŒ€í™”ì—ì„œ ë” í¸ì•ˆí•¨ì„ ëŠë¼ë©°, ì§„ì§€í•œ ë¶„ìœ„ê¸°ë¥¼ ë¶€ë‹´ìŠ¤ëŸ¬ì›Œí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ìƒëŒ€ë°©ì˜ ì§„ì§€í•œ ì´ì•¼ê¸°ë¥¼ ê²½ì²­í•˜ê³ , ìì‹ ì˜ ìƒê°ë„ ì†”ì§í•˜ê²Œ ë‚˜ëˆ„ë©° ê¹Šì€ êµê°ì„ ë§Œë“¤ì–´ê°€ìš”. í”¼ìƒì ì¸ ê´€ê³„ë³´ë‹¤ëŠ” ì •ì‹ ì ìœ¼ë¡œ ì—°ê²°ëœ ê¹Šì´ ìˆëŠ” ê´€ê³„ë¥¼ ì¶”êµ¬í•©ë‹ˆë‹¤.`
    },
    {
      type: 'ììœ ë¡œìš´ ìì—°ì¸',
      activeTraits: ['êµ¬ì†ë°›ì§€ ì•ŠëŠ” ììœ ë¡œì›€', 'ì¦‰í¥ì ì¸ ì„±í–¥', 'í‹€ì— ë°•íˆì§€ ì•ŠìŒ'],
      passiveTraits: ['í¸ì•ˆí•œ ê´€ê³„ ì¶”êµ¬', 'ë¶€ë‹´ ì—†ëŠ” íƒœë„', 'ìì—°ìŠ¤ëŸ¬ìš´ íë¦„ ì„ í˜¸'],
      activeDesc: (name: string) => `${name}ë‹˜ì€ í‹€ì— ë°•íˆì§€ ì•Šê³  ììœ ë¡­ê²Œ ê´€ê³„ë¥¼ ì´ì–´ê°€ëŠ” ììœ ë¡œìš´ ì˜í˜¼ì…ë‹ˆë‹¤. ì¦‰í¥ì ì´ê³  ìì—°ìŠ¤ëŸ¬ìš´ ë§Œë‚¨ì„ ì¦ê¸°ë©°, ì •í•´ì§„ ë£°ì´ë‚˜ ê³„íšì— ì–½ë§¤ì´ì§€ ì•ŠëŠ” ê²ƒì„ ì„ í˜¸í•´ìš”. ë¶€ë‹´ ì—†ëŠ” ê´€ê³„ë¥¼ ì¶”êµ¬í•˜ë©°, í˜•ì‹ë³´ë‹¤ëŠ” ì§„ì •ì„±ì„ ì¤‘ì‹œí•˜ê³ , ì¸ìœ„ì ì¸ ê²ƒë³´ë‹¤ ìì—°ìŠ¤ëŸ¬ìš´ íë¦„ì„ ë”°ë¼ê°€ëŠ” ê²ƒì„ ì¢‹ì•„í•©ë‹ˆë‹¤. ë§Œë‚¨ì˜ ë¹ˆë„ë‚˜ ë°©ì‹ì— êµ¬ì• ë°›ì§€ ì•Šê³ , ê·¸ë•Œê·¸ë•Œì˜ ê¸°ë¶„ê³¼ ìƒí™©ì— ë”°ë¼ ìœ ì—°í•˜ê²Œ ëŒ€ì²˜í•´ìš”. ììœ ë¡œìš´ ì„±í–¥ ë•Œë¬¸ì— ë•Œë¡œëŠ” ì˜ˆì¸¡í•˜ê¸° ì–´ë µì§€ë§Œ, ê·¸ë§Œí¼ ì§„ì •ì„± ìˆê³  í¸ì•ˆí•œ ê´€ê³„ë¥¼ ë§Œë“¤ì–´ê°‘ë‹ˆë‹¤.`,
      passiveDesc: (name: string) => `${name}ë‹˜ì€ í¸ì•ˆí•˜ê³  ë¶€ë‹´ ì—†ëŠ” ê´€ê³„ë¥¼ ì¶”êµ¬í•˜ëŠ” ìì—°ìŠ¤ëŸ¬ìš´ ìŠ¤íƒ€ì¼ì…ë‹ˆë‹¤. ìì—°ìŠ¤ëŸ¬ìš´ íë¦„ì„ ë”°ë¼ê°€ë©° ê°•ìš”í•˜ì§€ ì•ŠëŠ” íƒœë„ë¥¼ ë³´ì´ê³ , ìƒëŒ€ë°©ì˜ í˜ì´ìŠ¤ë¥¼ ì¡´ì¤‘í•˜ë©° ë§ì¶°ì¤˜ìš”. ì •í•´ì§„ ê·œì¹™ì´ë‚˜ ì•½ì†ì— ì–½ë§¤ì´ê¸°ë³´ë‹¤ëŠ”, ê·¸ë•Œê·¸ë•Œ í¸ì•ˆí•œ ë°©ì‹ìœ¼ë¡œ ê´€ê³„ë¥¼ ì´ì–´ê°€ëŠ” ê²ƒì„ ì„ í˜¸í•©ë‹ˆë‹¤. ë¶€ë‹´ìŠ¤ëŸ¬ìš´ ìš”êµ¬ë‚˜ ê¸°ëŒ€ë¥¼ í•˜ì§€ ì•Šìœ¼ë©°, ì„œë¡œì—ê²Œ ììœ ë¥¼ ì£¼ëŠ” ê´€ê³„ë¥¼ ì¶”êµ¬í•´ìš”. í¸ì•ˆí•¨ì„ ì¤‘ì‹œí•˜ê¸° ë•Œë¬¸ì— ì–µì§€ë¡œ ë§Œë“¤ì–´ì§€ëŠ” ë¶„ìœ„ê¸°ë¥¼ ì‹«ì–´í•˜ë©°, ìì—°ìŠ¤ëŸ½ê²Œ ì´ì–´ì§€ëŠ” ê´€ê³„ë¥¼ ê°€ì¥ ì†Œì¤‘íˆ ì—¬ê¹ë‹ˆë‹¤.`
    },
    {
      type: 'ì„¸ì‹¬í•œ ê´€ì°°ì',
      activeTraits: ['ì‘ì€ ë³€í™”ë„ ì˜ ì•Œì•„ì±”', 'ì„¬ì„¸í•œ ê´€ì°°ë ¥', 'ë””í…Œì¼ì„ ì¤‘ì‹œí•¨'],
      passiveTraits: ['ì¡°ìš©íˆ ì§€ì¼œë´„', 'ìƒí™© íŒŒì•…ì„ ì˜í•¨', 'ëˆˆì¹˜ê°€ ë¹ ë¥¸ í¸'],
      activeDesc: (name: string) => `${name}ë‹˜ì€ ìƒëŒ€ë°©ì˜ ì‘ì€ ë³€í™”ì™€ ê°ì •ê¹Œì§€ ì„¬ì„¸í•˜ê²Œ í¬ì°©í•˜ëŠ” ë””í…Œì¼ì˜ ë‹¬ì¸ì…ë‹ˆë‹¤. ê´€ì°°ë ¥ì´ ë›°ì–´ë‚˜ ìƒëŒ€ë°©ì˜ ë§íˆ¬, í‘œì •, í–‰ë™ íŒ¨í„´ì„ ì£¼ì˜ ê¹Šê²Œ ì‚´í”¼ë©°, ìˆ¨ì€ ì˜ë¯¸ë‚˜ ê°ì •ê¹Œì§€ ì½ì–´ë‚´ìš”. ë””í…Œì¼ì„ ì¤‘ì‹œí•˜ê¸° ë•Œë¬¸ì— ìƒëŒ€ë°©ì˜ ì‘ì€ ë³€í™”ë„ ë†“ì¹˜ì§€ ì•Šê³ , "ì˜¤ëŠ˜ ì¢€ í”¼ê³¤í•´ ë³´ì´ë„¤", "ê¸°ë¶„ ì•ˆ ì¢‹ì€ ì¼ ìˆì—ˆì–´?" ê°™ì€ ì„¸ì‹¬í•œ ì§ˆë¬¸ì„ ê±´ë„µë‹ˆë‹¤. ìƒëŒ€ë°©ì´ ë§í•˜ì§€ ì•Šì•„ë„ ëˆˆì¹˜ë¡œ íŒŒì•…í•˜ëŠ” ëŠ¥ë ¥ì´ ìˆì–´, í•„ìš”í•œ ìˆœê°„ì— ì ì ˆí•œ ë°°ë ¤ë‚˜ ìœ„ë¡œë¥¼ ì œê³µí•´ìš”. ì„¬ì„¸í•œ ê´€ì°°ì„ í†µí•´ ìƒëŒ€ë°©ì„ ê¹Šì´ ì´í•´í•˜ë ¤ ë…¸ë ¥í•©ë‹ˆë‹¤.`,
      passiveDesc: (name: string) => `${name}ë‹˜ì€ ì¡°ìš©íˆ ì§€ì¼œë³´ë©° ìƒí™©ì„ íŒŒì•…í•˜ëŠ” ëˆˆì¹˜ ë¹ ë¥¸ ê´€ì°°ìì…ë‹ˆë‹¤. ë§ì„ ë§ì´ í•˜ì§€ ì•Šë”ë¼ë„ ë¶„ìœ„ê¸°ë¥¼ ì˜ ì½ê³ , ìƒëŒ€ë°©ì˜ ê°ì • ìƒíƒœë‚˜ ìƒí™©ì„ ì •í™•íˆ íŒŒì•…í•˜ëŠ” ëŠ¥ë ¥ì´ ìˆì–´ìš”. ìƒí™© íŒë‹¨ì´ ë¹ ë¥´ê³  ëˆˆì¹˜ê°€ ìˆì–´ì„œ, ì–´ìƒ‰í•œ ìˆœê°„ì´ë‚˜ ë¶ˆí¸í•œ ë¶„ìœ„ê¸°ë¥¼ ì¬ë¹¨ë¦¬ ê°ì§€í•˜ê³  ì ì ˆíˆ ëŒ€ì²˜í•©ë‹ˆë‹¤. ì¡°ìš©íˆ ì§€ì¼œë³´ëŠ” ê²ƒì„ ì„ í˜¸í•˜ì§€ë§Œ, í•„ìš”í•œ ìˆœê°„ì—ëŠ” ì •í™•í•œ íŒë‹¨ìœ¼ë¡œ ë„ì›€ì„ ì£¼ëŠ” ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ì¡´ì¬ì˜ˆìš”. ê³¼ë„í•˜ê²Œ ë‚˜ì„œì§€ ì•Šì§€ë§Œ, í•­ìƒ ìƒí™©ì„ íŒŒì•…í•˜ê³  ìˆì–´ ì•ˆì •ê°ì„ ì¤ë‹ˆë‹¤.`
    },
    {
      type: 'ì—´ì •ì ì¸ ë„ì „ê°€',
      activeTraits: ['ìƒˆë¡œìš´ ì‹œë„ë¥¼ ì¦ê¹€', 'ëª¨í—˜ì„ ë‘ë ¤ì›Œí•˜ì§€ ì•ŠìŒ', 'ì—´ì •ì´ ë„˜ì¹¨'],
      passiveTraits: ['ë„ì „ì„ ì‘ì›í•¨', 'ìƒˆë¡œìš´ ê²½í—˜ì— ì—´ë ¤ìˆìŒ', 'ê¸ì •ì ì¸ ë§ˆì¸ë“œ'],
      activeDesc: (name: string) => `${name}ë‹˜ì€ ìƒˆë¡œìš´ ê²ƒì— ë„ì „í•˜ê³  ëª¨í—˜ì„ ì¦ê¸°ëŠ” ì—´ì • ë„˜ì¹˜ëŠ” ë„ì „ê°€ì…ë‹ˆë‹¤. ì•ˆì •ì ì¸ ê²ƒë³´ë‹¤ ìƒˆë¡œìš´ ê²½í—˜ì„ ì¶”êµ¬í•˜ë©°, ê´€ê³„ì—ì„œë„ ë‹¤ì–‘í•œ ì‹œë„ë¥¼ í†µí•´ í™œê¸°ë¥¼ ë¶ˆì–´ë„£ì–´ìš”. ì—´ì •ì´ ë„˜ì¹˜ê³  ì—ë„ˆì§€ê°€ ë§ì•„ì„œ, í•¨ê»˜ ìˆìœ¼ë©´ ì§€ë£¨í•  í‹ˆì´ ì—†ê³  í•­ìƒ ìƒˆë¡œìš´ ì¼ì´ ë²Œì–´ì§‘ë‹ˆë‹¤. ëª¨í—˜ì„ ë‘ë ¤ì›Œí•˜ì§€ ì•Šê³  ì ê·¹ì ìœ¼ë¡œ ë„ì „í•˜ë©°, ì‹¤íŒ¨ë¥¼ ë‘ë ¤ì›Œí•˜ê¸°ë³´ë‹¤ëŠ” ë°°ì›€ì˜ ê¸°íšŒë¡œ ì‚¼ëŠ” ê¸ì •ì ì¸ ë§ˆì¸ë“œë¥¼ ê°€ì§€ê³  ìˆì–´ìš”. ê´€ê³„ì—ì„œë„ ë£¨í‹´ì— ë¹ ì§€ì§€ ì•Šê³  ê³„ì†í•´ì„œ ìƒˆë¡œìš´ ê²½í—˜ì„ í•¨ê»˜ ë§Œë“¤ì–´ê°€ë©° ì„±ì¥í•˜ë ¤ í•©ë‹ˆë‹¤.`,
      passiveDesc: (name: string) => `${name}ë‹˜ì€ ìƒëŒ€ë°©ì˜ ë„ì „ì„ ì‘ì›í•˜ê³  ìƒˆë¡œìš´ ê²½í—˜ì— ì—´ë ¤ìˆëŠ” ì§€ì§€í˜• ë„ì „ê°€ì…ë‹ˆë‹¤. ê¸ì •ì ì¸ ë§ˆì¸ë“œë¡œ ìƒëŒ€ë°©ì˜ ìƒˆë¡œìš´ ì‹œë„ë¥¼ ê²©ë ¤í•˜ê³ , í•¨ê»˜ ì„±ì¥í•´ ë‚˜ê°€ëŠ” ê²ƒì„ ì¦ê±°ì›Œí•´ìš”. ë³€í™”ë¥¼ ë‘ë ¤ì›Œí•˜ì§€ ì•Šê³  ìƒˆë¡œìš´ ê²½í—˜ì— ì—´ë¦° ìì„¸ë¥¼ ë³´ì´ë©°, ìƒëŒ€ë°©ì´ ì œì•ˆí•˜ëŠ” ìƒˆë¡œìš´ í™œë™ì´ë‚˜ ë§Œë‚¨ ë°©ì‹ì„ ê¸°êº¼ì´ ë°›ì•„ë“¤ì…ë‹ˆë‹¤. ì•ˆì •ë³´ë‹¤ëŠ” ì„±ì¥ê³¼ ë°œì „ì„ ì¤‘ì‹œí•˜ë©°, í•¨ê»˜ ë„ì „í•˜ê³  ê²½í—˜ì„ ìŒ“ì•„ê°€ëŠ” ì—­ë™ì ì¸ ê´€ê³„ë¥¼ ì„ í˜¸í•´ìš”. ê¸ì •ì ì¸ ì—ë„ˆì§€ë¡œ ìƒëŒ€ë°©ì—ê²Œ ìš©ê¸°ë¥¼ ì£¼ê³ , í•¨ê»˜ ë‚˜ì•„ê°€ëŠ” ë“ ë“ í•œ íŒŒíŠ¸ë„ˆê°€ ë©ë‹ˆë‹¤.`
    }
  ]

  // ëœë¤í•˜ê²Œ íƒ€ì… ì„ íƒ
  const type1 = personalityTypes[Math.floor(Math.random() * personalityTypes.length)]
  const type2 = personalityTypes[Math.floor(Math.random() * personalityTypes.length)]
  const isP1Active = countP1 > countP2

  const personalities = {
    [p1]: {
      type: type1.type,
      traits: isP1Active ? type1.activeTraits : type1.passiveTraits,
      description: isP1Active ? type1.activeDesc(p1) : type1.passiveDesc(p1)
    },
    [p2]: {
      type: type2.type,
      traits: !isP1Active ? type2.activeTraits : type2.passiveTraits,
      description: !isP1Active ? type2.activeDesc(p2) : type2.passiveDesc(p2)
    }
  }

  // ìƒí˜¸ ì¸ì‹ ë¶„ì„ (ìƒëŒ€ë°©ì´ ë‚˜ë¥¼ ì–´ë–»ê²Œ ìƒê°í•˜ëŠ”ì§€ / ë‚´ê°€ ìƒëŒ€ë°©ì„ ì–´ë–»ê²Œ ìƒê°í•˜ëŠ”ì§€)
  const perceptionTemplates = [
    {
      // ê¸ì •ì ì´ê³  ê´€ì‹¬ ë§ì€ ê²½ìš°
      thinkingAboutYou: (name: string) => `${name}ë‹˜ì€ ë‹¹ì‹ ê³¼ì˜ ëŒ€í™”ë¥¼ ë§¤ìš° ì¦ê¸°ê³  ìˆìŠµë‹ˆë‹¤. ë‹µì¥ ì†ë„ê°€ ë¹ ë¥´ê³ , ëŒ€í™”ê°€ ëë‚  ê²ƒ ê°™ìœ¼ë©´ ìƒˆë¡œìš´ í™”ì œë¥¼ êº¼ë‚´ë©° ëŒ€í™”ë¥¼ ì´ì–´ê°€ë ¤ëŠ” ë…¸ë ¥ì´ ëšœë ·í•˜ê²Œ ë³´ì—¬ìš”. íŠ¹íˆ ë‹¹ì‹ ì´ ë³´ë‚¸ ë©”ì‹œì§€ì— ì§ˆë¬¸ìœ¼ë¡œ ë‹µí•˜ëŠ” ê²½ìš°ê°€ ë§ì•„ ê´€ì‹¬ì´ ë†’ë‹¤ëŠ” ì‹ í˜¸ì…ë‹ˆë‹¤. ê°ì •ì ìœ¼ë¡œëŠ” í˜¸ê°ì„ ë„˜ì–´ ì„¤ë ˆëŠ” ë‹¨ê³„ë¡œ ì ‘ì–´ë“  ê²ƒìœ¼ë¡œ ë³´ì´ë©°, ë‹¹ì‹ ê³¼ ë” ê°€ê¹Œì›Œì§€ê³  ì‹¶ì–´í•˜ëŠ” ë§ˆìŒì´ ëŒ€í™” ê³³ê³³ì—ì„œ ëŠê»´ì§‘ë‹ˆë‹¤.`,
      youThinkingAbout: (name: string) => `ë‹¹ì‹ ì€ ${name}ë‹˜ì—ê²Œ ìƒë‹¹í•œ ê´€ì‹¬ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. ë¨¼ì € ëŒ€í™”ë¥¼ ì‹œì‘í•˜ëŠ” ë¹ˆë„ê°€ ë†’ê³ , ìƒëŒ€ë°©ì˜ ì¼ìƒì— ëŒ€í•œ ì§ˆë¬¸ì„ ìì£¼ í•˜ëŠ” íŒ¨í„´ì´ ë³´ì—¬ìš”. ë©”ì‹œì§€ ê¸¸ì´ë„ ìƒëŒ€ë°©ë³´ë‹¤ ê¸´ í¸ì´ë©°, ì´ëª¨í‹°ì½˜ê³¼ ã…‹ã…‹ã…‹ë¥¼ ë§ì´ ì‚¬ìš©í•´ ì¹œê·¼í•œ ë¶„ìœ„ê¸°ë¥¼ ë§Œë“¤ë ¤ê³  ë…¸ë ¥í•˜ê³  ìˆìŠµë‹ˆë‹¤. ëŒ€í™”ê°€ ëŠê¸°ë©´ ë¶ˆì•ˆí•´í•˜ëŠ” ë“¯í•œ ëª¨ìŠµë„ ì—¿ë³´ì´ë©°, ìƒëŒ€ë°©ì˜ ë‹µì¥ì„ ê¸°ë‹¤ë¦¬ëŠ” ì‹œê°„ì—ë„ ì‹ ê²½ì„ ë§ì´ ì“°ê³  ìˆëŠ” ê²ƒ ê°™ì•„ìš”.`
    },
    {
      // í¸ì•ˆí•˜ê³  ì¹œê·¼í•œ ê²½ìš°
      thinkingAboutYou: (name: string) => `${name}ë‹˜ì€ ë‹¹ì‹ ì„ ë§¤ìš° í¸ì•ˆí•œ ì¡´ì¬ë¡œ ì—¬ê¸°ê³  ìˆì–´ìš”. ì¼ìƒì ì¸ ì†Œì†Œí•œ ì´ì•¼ê¸°ë„ ë¶€ë‹´ ì—†ì´ ë‚˜ëˆ„ë©°, íŠ¹ë³„íˆ ê¾¸ë¯¸ì§€ ì•Šì€ ì†”ì§í•œ ëª¨ìŠµì„ ë³´ì—¬ì¤ë‹ˆë‹¤. ë‹µì¥ ì‹œê°„ì´ ì¼ì •í•˜ì§€ ì•Šì•„ë„ ì„œë¡œ ì´í•´í•˜ëŠ” ë¶„ìœ„ê¸°ì´ë©°, ëŒ€í™”ì˜ ì£¼ì œê°€ ê¹Šì´ ìˆê±°ë‚˜ ê°€ë²¼ì›Œë„ ìì—°ìŠ¤ëŸ½ê²Œ ë°›ì•„ë“¤ì—¬ìš”. ì‹ ë¢°ê°ì´ ìŒ“ì—¬ ìˆì–´ ê°ì •ì ì¸ ì´ì•¼ê¸°ë„ ì¢…ì¢… ê³µìœ í•˜ëŠ” í¸ì´ë©°, ë‹¹ì‹ ì„ 'í¸í•œ ì‚¬ëŒ'ìœ¼ë¡œ ë¶„ë¥˜í•˜ê³  ìˆì„ ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤.`,
      youThinkingAbout: (name: string) => `ë‹¹ì‹ ì€ ${name}ë‹˜ê³¼ ìˆì„ ë•Œ ê°€ì¥ ìì—°ìŠ¤ëŸ¬ìš´ ëª¨ìŠµì„ ë³´ì´ê³  ìˆì–´ìš”. ì–µì§€ë¡œ ëŒ€í™”ë¥¼ ì´ì–´ê°€ë ¤ í•˜ì§€ ì•Šì•„ë„ í¸ì•ˆí•˜ê²Œ ì¹¨ë¬µì„ ì¦ê¸¸ ìˆ˜ ìˆê³ , íŠ¹ë³„í•œ ì´ë²¤íŠ¸ ì—†ì´ë„ ì¼ìƒì„ ê³µìœ í•˜ëŠ” ê²ƒë§Œìœ¼ë¡œ ë§Œì¡±í•˜ëŠ” ê²ƒ ê°™ìŠµë‹ˆë‹¤. ìƒëŒ€ë°©ì—ê²Œ ì¢‹ì€ ì¸ìƒì„ ì£¼ë ¤ëŠ” ê³¼ë„í•œ ë…¸ë ¥ë³´ë‹¤ëŠ”, ìˆëŠ” ê·¸ëŒ€ë¡œì˜ ëª¨ìŠµì„ ë³´ì—¬ì£¼ë©° ì§„ì •ì„± ìˆëŠ” ê´€ê³„ë¥¼ ë§Œë“¤ì–´ê°€ê³  ìˆì–´ìš”. ì´ëŸ° í¸ì•ˆí•¨ì€ ì˜¤ë˜ ì§€ì†ë  ìˆ˜ ìˆëŠ” ì¢‹ì€ ê´€ê³„ì˜ ê¸°ë°˜ì…ë‹ˆë‹¤.`
    },
    {
      // ì¡°ì‹¬ìŠ¤ëŸ½ê³  ì‹ ì¤‘í•œ ê²½ìš°
      thinkingAboutYou: (name: string) => `${name}ë‹˜ì€ ë‹¹ì‹ ì—ê²Œ ì¡°ì‹¬ìŠ¤ëŸ½ê²Œ ì ‘ê·¼í•˜ê³  ìˆìŠµë‹ˆë‹¤. ë‹µì¥ì€ í•˜ì§€ë§Œ ë„ˆë¬´ ë¹ ë¥´ì§€ë„, ë„ˆë¬´ ëŠ¦ì§€ë„ ì•Šì€ ì ì ˆí•œ íƒ€ì´ë°ì„ ìœ ì§€í•˜ë©°, ê°ì •ì„ ë…¸ì¶œí•˜ê¸°ë³´ë‹¤ëŠ” ì‚¬ì‹¤ ìœ„ì£¼ì˜ ëŒ€í™”ë¥¼ ì„ í˜¸í•˜ëŠ” ê²½í–¥ì´ ë³´ì—¬ìš”. ì•„ì§ ë‹¹ì‹ ì„ ì™„ì „íˆ ì‹ ë¢°í•˜ì§€ëŠ” ì•Šì§€ë§Œ, ì„œì„œíˆ ë²½ì„ í—ˆë¬¼ê³  ê°€ê¹Œì›Œì§€ë ¤ëŠ” ë…¸ë ¥ì´ ëŠê»´ì§‘ë‹ˆë‹¤. ì‹œê°„ì´ ì§€ë‚˜ë©´ì„œ ì ì°¨ ê°œì¸ì ì¸ ì´ì•¼ê¸°ë¥¼ êº¼ë‚´ê¸° ì‹œì‘í•  ê²ƒìœ¼ë¡œ ë³´ì´ë©°, ê´€ê³„ ë°œì „ ì†ë„ëŠ” ëŠë¦¬ì§€ë§Œ ì•ˆì •ì ì¼ ê²ƒ ê°™ìŠµë‹ˆë‹¤.`,
      youThinkingAbout: (name: string) => `ë‹¹ì‹ ì€ ${name}ë‹˜ì—ê²Œ ì‹ ì¤‘í•˜ê²Œ ë‹¤ê°€ê°€ê³  ìˆì–´ìš”. ë„ˆë¬´ ë¹ ë¥´ê²Œ ì¹œí•´ì§€ëŠ” ê²ƒì„ ê²½ê³„í•˜ë©´ì„œë„, ì¡°ê¸ˆì”© ê´€ì‹¬ì„ í‘œí˜„í•˜ëŠ” ëª¨ìŠµì´ ë³´ì…ë‹ˆë‹¤. ìƒëŒ€ë°©ì˜ ë°˜ì‘ì„ ì‚´í”¼ë©° í•œ ë°œì§ì”© ë‹¤ê°€ê°€ëŠ” ì „ëµì„ ì·¨í•˜ê³  ìˆìœ¼ë©°, ê±°ì ˆë‹¹í•  ìœ„í—˜ì„ ìµœì†Œí™”í•˜ë ¤ëŠ” ë°©ì–´ì ì¸ íƒœë„ë„ ì¼ë¶€ ì—¿ë³´ì—¬ìš”. ê´€ê³„ë¥¼ ë°œì „ì‹œí‚¤ê³  ì‹¶ì€ ë§ˆìŒì€ ìˆì§€ë§Œ, í™•ì‹ ì´ ì„œê¸° ì „ê¹Œì§€ëŠ” ê°ì •ì„ ìˆ¨ê¸°ë©° ì•ˆì „í•œ ê±°ë¦¬ë¥¼ ìœ ì§€í•˜ë ¤ëŠ” ê²ƒ ê°™ìŠµë‹ˆë‹¤.`
    },
    {
      // ê´€ì‹¬ì€ ìˆì§€ë§Œ ê±°ë¦¬ê°ì´ ìˆëŠ” ê²½ìš°
      thinkingAboutYou: (name: string) => `${name}ë‹˜ì€ ë‹¹ì‹ ì—ê²Œ ê´€ì‹¬ì€ ìˆì§€ë§Œ, ëª…í™•í•œ ê±°ë¦¬ë¥¼ ë‘ê³  ìˆìŠµë‹ˆë‹¤. ë‹µì¥ì´ ë¶ˆê·œì¹™í•˜ê³ , ë•Œë¡œëŠ” ì§§ì€ ëŒ€ë‹µìœ¼ë¡œ ëŒ€í™”ë¥¼ ë§ˆë¬´ë¦¬í•˜ë ¤ëŠ” ê²½í–¥ì´ ë³´ì—¬ìš”. ê¹Šì€ ê°ì • êµë¥˜ë³´ë‹¤ëŠ” í‘œë©´ì ì¸ ëŒ€í™”ë¥¼ ìœ ì§€í•˜ë©°, ë‹¹ì‹ ì´ ì ê·¹ì ìœ¼ë¡œ ë‹¤ê°€ì˜¬ ë•ŒëŠ” í•œ ë°œì§ ë¬¼ëŸ¬ì„œëŠ” íŒ¨í„´ì´ ê´€ì°°ë©ë‹ˆë‹¤. ì•„ì§ ë‹¹ì‹ ì— ëŒ€í•œ í™•ì‹ ì´ ì„œì§€ ì•Šì•˜ê±°ë‚˜, ë‹¤ë¥¸ ê´€ì‹¬ì‚¬ê°€ ìˆì„ ìˆ˜ë„ ìˆì–´ìš”. í˜„ì¬ë¡œì„œëŠ” 'ì¹œêµ¬' ì´ìƒì˜ ê°ì •ì€ ì—†ëŠ” ê²ƒìœ¼ë¡œ ë³´ì´ë©°, ê´€ê³„ ë°œì „ì„ ìœ„í•´ì„œëŠ” ì‹œê°„ê³¼ ì¸ë‚´ê°€ í•„ìš”í•  ê²ƒ ê°™ìŠµë‹ˆë‹¤.`,
      youThinkingAbout: (name: string) => `ë‹¹ì‹ ì€ ${name}ë‹˜ì„ ì¢‹ì•„í•˜ì§€ë§Œ, ê·¸ ë§ˆìŒì„ ìˆ¨ê¸°ë ¤ê³  ì• ì“°ëŠ” ëª¨ìŠµì´ ì—­ë ¥í•©ë‹ˆë‹¤. ë¨¼ì € ì—°ë½í•˜ê³  ì‹¶ì§€ë§Œ ì°¸ëŠ” ê²½ìš°ê°€ ë§ê³ , ë‹µì¥ì„ ë°›ìœ¼ë©´ ê¸°ì˜ì§€ë§Œ í‹°ë¥¼ ë‚´ì§€ ì•Šìœ¼ë ¤ ë…¸ë ¥í•´ìš”. ë°€ë‹¹ì„ ì‹œë„í•˜ë©° ì ì ˆí•œ ê±°ë¦¬ë¥¼ ìœ ì§€í•˜ë ¤ í•˜ì§€ë§Œ, ì†ë§ˆìŒì€ ë” ê°€ê¹Œì›Œì§€ê³  ì‹¶ì–´í•˜ëŠ” ê²ƒì´ ëŒ€í™” íŒ¨í„´ì—ì„œ ë“œëŸ¬ë‚©ë‹ˆë‹¤. ê±°ì ˆë‹¹í•˜ëŠ” ê²ƒì´ ë‘ë ¤ì›Œ ë°©ì–´ì ì¸ íƒœë„ë¥¼ ì·¨í•˜ê³  ìˆìœ¼ë©°, ìƒëŒ€ë°©ì´ ë¨¼ì € ê´€ì‹¬ì„ ë³´ì—¬ì£¼ê¸°ë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ìˆ˜ë™ì ì¸ ìì„¸ê°€ ë³´ì—¬ìš”.`
    },
    {
      // ì„œë¡œ ëŒë¦¬ëŠ” ê²½ìš°
      thinkingAboutYou: (name: string) => `${name}ë‹˜ì€ ë‹¹ì‹ ì—ê²Œ ê°•í•˜ê²Œ ëŒë¦¬ê³  ìˆìŠµë‹ˆë‹¤. ë‹µì¥ì´ ê±°ì˜ ì¦‰ê°ì ìœ¼ë¡œ ì˜¤ë©°, ë‹¹ì‹ ì˜ ì‘ì€ ë†ë‹´ì—ë„ í¬ê²Œ ì›ƒì–´ì£¼ê³ , ë‹¹ì‹ ì´ ë³´ë‚¸ ë©”ì‹œì§€ í•˜ë‚˜í•˜ë‚˜ì— ì •ì„±ê» ë°˜ì‘í•©ë‹ˆë‹¤. ëŒ€í™”ê°€ ëë‚  ê¸°ë¯¸ê°€ ë³´ì´ë©´ ìƒˆë¡œìš´ ì£¼ì œë¥¼ êº¼ë‚´ë©° ê³„ì† ì´ì–´ê°€ë ¤ í•˜ê³ , ë‹¹ì‹ ì˜ ì¼ìƒì— ê¹Šì€ ê´€ì‹¬ì„ ë³´ì´ë©° ì„¸ì„¸í•œ ë¶€ë¶„ê¹Œì§€ ê¸°ì–µí•˜ê³  ìˆì–´ìš”. ê°ì •ì ìœ¼ë¡œ ìƒë‹¹íˆ íˆ¬ìí•˜ê³  ìˆìœ¼ë©°, ë‹¹ì‹ ê³¼ì˜ ê´€ê³„ë¥¼ ë°œì „ì‹œí‚¤ê³  ì‹¶ì–´í•˜ëŠ” ë§ˆìŒì´ ëŒ€í™” ê³³ê³³ì—ì„œ ëŠê»´ì§‘ë‹ˆë‹¤. ì´ëŠ” ë§¤ìš° ê¸ì •ì ì¸ ì‹ í˜¸ì´ë©°, ë‹¤ìŒ ë‹¨ê³„ë¡œ ë‚˜ì•„ê°ˆ ì¤€ë¹„ê°€ ë˜ì–´ ìˆëŠ” ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤.`,
      youThinkingAbout: (name: string) => `ë‹¹ì‹ ì€ ${name}ë‹˜ì—ê²Œ ì™„ì „íˆ ë¹ ì ¸ìˆëŠ” ìƒíƒœì…ë‹ˆë‹¤. ìƒëŒ€ë°©ì˜ ë©”ì‹œì§€ë¥¼ ì†ê¼½ì•„ ê¸°ë‹¤ë¦¬ê³ , ë‹µì¥ì´ ì˜¤ë©´ ì¦‰ì‹œ í™•ì¸í•˜ë©°, ëŒ€í™”ê°€ ëë‚˜ë©´ ì•„ì‰¬ì›Œí•˜ëŠ” ëª¨ìŠµì´ ì—­ë ¥í•´ìš”. ë©”ì‹œì§€ë¥¼ ë³´ë‚¼ ë•Œë„ ì—¬ëŸ¬ ë²ˆ ì½ì–´ë³´ë©° ì‹ ì¤‘í•˜ê²Œ ì‘ì„±í•˜ê³ , ìƒëŒ€ë°©ì´ ì¢‹ì•„í•  ë§Œí•œ ì£¼ì œë¥¼ ì°¾ìœ¼ë ¤ ë…¸ë ¥í•©ë‹ˆë‹¤. ã…‹ã…‹ã…‹ì™€ ì´ëª¨í‹°ì½˜ì„ ì ê·¹ í™œìš©í•´ ë¶„ìœ„ê¸°ë¥¼ ë„ìš°ë ¤ í•˜ê³ , ìƒëŒ€ë°©ì˜ ì‘ì€ ë°˜ì‘ì—ë„ í¬ê²Œ ê¸°ë»í•˜ëŠ” ëª¨ìŠµì´ ë³´ì—¬ìš”. ê°ì •ì´ ê³ ì¡°ëœ ìƒíƒœì´ë©°, ê´€ê³„ë¥¼ í•œ ë‹¨ê³„ ë°œì „ì‹œí‚¤ê³  ì‹¶ì–´í•˜ëŠ” ìš•êµ¬ê°€ ê°•í•œ ê²ƒìœ¼ë¡œ ë¶„ì„ë©ë‹ˆë‹¤.`
    },
    {
      // ì¹œêµ¬ ì´ìƒì˜ ê°ì •ì´ ìƒê¸°ëŠ” ê²½ìš°
      thinkingAboutYou: (name: string) => `${name}ë‹˜ì€ ë‹¹ì‹ ì„ ë‹¨ìˆœí•œ ì¹œêµ¬ ì´ìƒìœ¼ë¡œ ì¸ì‹í•˜ê¸° ì‹œì‘í–ˆìŠµë‹ˆë‹¤. ìµœê·¼ ëŒ€í™” íŒ¨í„´ì„ ë³´ë©´ ê´€ì‹¬ì˜ ê¹Šì´ì™€ ì§ˆì´ ë‹¬ë¼ì§€ê³  ìˆì–´ìš”. ì˜ˆì „ë³´ë‹¤ ê°œì¸ì ì¸ ì§ˆë¬¸ì´ ëŠ˜ì–´ë‚¬ê³ , ë‹¹ì‹ ì˜ ê°ì • ìƒíƒœì— ë” ì‹ ê²½ ì“°ëŠ” ëª¨ìŠµì´ ë³´ì…ë‹ˆë‹¤. ì‹¬ì•¼ ì‹œê°„ëŒ€ ëŒ€í™”ê°€ ì¦ê°€í–ˆê³ , ê°ì„±ì ì¸ ì£¼ì œë¥¼ êº¼ë‚´ëŠ” ë¹ˆë„ë„ ë†’ì•„ì¡Œì–´ìš”. ì•„ì§ ê³ ë°±ì´ë‚˜ ëª…í™•í•œ í‘œí˜„ì€ ì—†ì§€ë§Œ, ì¡°ê¸ˆì”© ë§ˆìŒì˜ ë³€í™”ê°€ ì¼ì–´ë‚˜ê³  ìˆìœ¼ë©°, ë‹¹ì‹ ì„ íŠ¹ë³„í•œ ì¡´ì¬ë¡œ ì—¬ê¸°ê¸° ì‹œì‘í•œ ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤. ì´ ì‹œê¸°ê°€ ê´€ê³„ì˜ ì¤‘ìš”í•œ ì „í™˜ì ì´ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`,
      youThinkingAbout: (name: string) => `ë‹¹ì‹ ë„ ${name}ë‹˜ì„ ì¹œêµ¬ ì´ìƒìœ¼ë¡œ ì˜ì‹í•˜ê³  ìˆìŠµë‹ˆë‹¤. ëŒ€í™”í•  ë•Œ ë”ìš± ì‹ ê²½ ì“°ê²Œ ë˜ê³ , ìƒëŒ€ë°©ì—ê²Œ ì¢‹ì€ ì¸ìƒì„ ë‚¨ê¸°ë ¤ëŠ” ë…¸ë ¥ì´ ì´ì „ë³´ë‹¤ ëšœë ·í•´ì¡Œì–´ìš”. ìƒëŒ€ë°©ì˜ ì‚¬ì†Œí•œ ë§ì—ë„ ì˜ë¯¸ë¥¼ ë¶€ì—¬í•˜ê³ , í˜¹ì‹œ ë‚˜ë¥¼ ì–´ë–»ê²Œ ìƒê°í• ê¹Œ ê³ ë¯¼í•˜ëŠ” ì‹œê°„ì´ ëŠ˜ì–´ë‚¬ìŠµë‹ˆë‹¤. ëŒ€í™” ì£¼ì œë„ ì ì°¨ ê¹Šì–´ì§€ê³  ìˆìœ¼ë©°, ìƒëŒ€ë°©ê³¼ì˜ ê³µí†µì ì„ ì°¾ìœ¼ë ¤ëŠ” ë…¸ë ¥ê³¼ í•¨ê»˜ íŠ¹ë³„í•œ ì¶”ì–µì„ ë§Œë“¤ê³  ì‹¶ì–´í•˜ëŠ” ìš•êµ¬ê°€ ìƒê²¼ì–´ìš”. ê°ì •ì´ ì¹œêµ¬ì—ì„œ ì—°ì¸ ì‚¬ì´ì˜ ê²½ê³„ì„ ì—ì„œ í”ë“¤ë¦¬ê³  ìˆëŠ” ìƒíƒœì…ë‹ˆë‹¤.`
    }
  ]

  // ì‹¤ì œ ë°ì´í„° ê¸°ë°˜ ìƒí˜¸ ì¸ì‹ ë¶„ì„ í•¨ìˆ˜
  function generatePerceptionAnalysis(person: string, target: string, personStats: any, targetStats: any, personCount: number, targetCount: number) {
    const totalMessages = personCount + targetCount
    const personRatio = Math.round((personCount / totalMessages) * 100)

    const personFirstMsg = personStats?.firstMessageCount || 0
    const targetFirstMsg = targetStats?.firstMessageCount || 0

    const personAvgReply = personStats?.avgReplyTime || 0
    const targetAvgReply = targetStats?.avgReplyTime || 0

    const personLaugh = personStats?.laughCount || 0
    const targetLaugh = targetStats?.laughCount || 0

    const personQuestion = personStats?.questionCount || 0
    const targetQuestion = targetStats?.questionCount || 0

    const personInstant = personStats?.instantReplyRate || 0

    // ê´€ê³„ì„± ë¶„ì„: ê´€ì‹¬ë„, ì†Œí†µ ìŠ¤íƒ€ì¼, ê°ì • í‘œí˜„
    let analysis = ''

    // 1. ê´€ì‹¬ë„ ë° ì£¼ë„ì„± ë¶„ì„ (ëŒ€í™” ì‹œì‘ + ë©”ì‹œì§€ ë¹„ìœ¨)
    if (personFirstMsg > targetFirstMsg * 1.3 && personRatio > 55) {
      analysis += `ëŒ€í™”ì—ì„œ ì£¼ë„ì ì¸ ì—­í• ì„ í•˜ë©° ${target}ë‹˜ê³¼ì˜ ì†Œí†µì„ ì¤‘ìš”í•˜ê²Œ ì—¬ê¸°ëŠ” ëª¨ìŠµì´ ëšœë ·í•©ë‹ˆë‹¤. `
      if (personAvgReply < 30) {
        analysis += `ë¹ ë¥¸ ë‹µì¥ ì†ë„ëŠ” ${target}ë‹˜ì˜ ë©”ì‹œì§€ë¥¼ ê¸°ë‹¤ë¦¬ê³  ìˆìŒì„ ë³´ì—¬ì£¼ë©°, ê´€ê³„ì— ëŒ€í•œ ë†’ì€ ê´€ì‹¬ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. `
      }
    } else if (personFirstMsg > targetFirstMsg) {
      analysis += `${target}ë‹˜ì—ê²Œ ë¨¼ì € ì—°ë½í•˜ëŠ” ê²½ìš°ê°€ ë§ì•„ ê´€ê³„ ìœ ì§€ì— ì ê·¹ì ì¸ íƒœë„ë¥¼ ë³´ì…ë‹ˆë‹¤. `
      if (personAvgReply < 60) {
        analysis += `ì ë‹¹í•œ ë‹µì¥ ì†ë„ë¡œ ëŒ€í™”ì— ì„±ì‹¤í•˜ê²Œ ì„í•˜ê³  ìˆìœ¼ë©°, `
      }
    } else {
      analysis += `ëŒ€í™”ëŠ” ìƒëŒ€ë°©ì´ ë” ìì£¼ ì‹œì‘í•˜ì§€ë§Œ, í•œë²ˆ ì‹œì‘ëœ ëŒ€í™”ì—ëŠ” ì ê·¹ì ìœ¼ë¡œ ì°¸ì—¬í•˜ëŠ” í¸ì…ë‹ˆë‹¤. `
      if (personRatio > 50) {
        analysis += `ì‹¤ì œ ë©”ì‹œì§€ ë¹„ì¤‘ì„ ë³´ë©´ ëŒ€í™”ë¥¼ ì´ëŒì–´ê°€ë ¤ëŠ” ë…¸ë ¥ì´ ë³´ì´ë©°, `
      }
    }

    // 2. ê°ì • í‘œí˜„ ë° ë¶„ìœ„ê¸° ì¡°ì„± (ì›ƒìŒ + ì§ˆë¬¸)
    const laughRatio = targetLaugh > 0 ? personLaugh / targetLaugh : 1
    const questionRatio = targetQuestion > 0 ? personQuestion / targetQuestion : 1

    if (laughRatio > 1.5 && questionRatio > 1.3) {
      analysis += `${target}ë‹˜ê³¼ì˜ ëŒ€í™”ë¥¼ ì¦ê²ê²Œ ìœ ì§€í•˜ë ¤ëŠ” ë…¸ë ¥ì´ ë‹ë³´ì´ë©°, ë§ì€ ì§ˆë¬¸ì„ í†µí•´ ìƒëŒ€ë°©ì— ëŒ€í•´ ë” ì•Œê³  ì‹¶ì–´í•˜ëŠ” í˜¸ê¸°ì‹¬ë„ í¬ê²Œ ë‚˜íƒ€ë‚©ë‹ˆë‹¤. `
    } else if (laughRatio > 1.3) {
      analysis += `ìƒëŒ€ë°©ë³´ë‹¤ ë” ìì£¼ ì›ƒìŒì„ í‘œí˜„í•˜ë©° í¸ì•ˆí•˜ê³  ì¦ê±°ìš´ ë¶„ìœ„ê¸°ë¥¼ ë§Œë“¤ë ¤ê³  ë…¸ë ¥í•©ë‹ˆë‹¤. `
      if (questionRatio > 1) {
        analysis += `ì§ˆë¬¸ì„ í†µí•´ ëŒ€í™”ë¥¼ ì´ì–´ê°€ë©° ${target}ë‹˜ì— ëŒ€í•œ ê´€ì‹¬ì„ ë³´ì—¬ì£¼ê³  ìˆìŠµë‹ˆë‹¤. `
      }
    } else if (questionRatio > 1.5) {
      analysis += `${target}ë‹˜ì— ëŒ€í•œ í˜¸ê¸°ì‹¬ì´ ë§ì•„ ì§ˆë¬¸ì„ ìì£¼ ë˜ì§€ë©°, ìƒëŒ€ë°©ì„ ë” ê¹Šì´ ì•Œì•„ê°€ê³  ì‹¶ì–´í•˜ëŠ” ë§ˆìŒì´ ì—¿ë³´ì…ë‹ˆë‹¤. `
    } else if (laughRatio > 0.7 && questionRatio > 0.7) {
      analysis += `ê°ì • í‘œí˜„ê³¼ ì§ˆë¬¸ì˜ ê· í˜•ì´ ì˜ ë§ì•„ ëŒ€í™”ì—ì„œ ì„œë¡œ ë°°ë ¤í•˜ëŠ” ê´€ê³„ë¡œ ë³´ì…ë‹ˆë‹¤. `
    }

    // 3. ë‹µì¥ íŒ¨í„´ ë° ì†Œí†µ ìŠ¤íƒ€ì¼
    if (personInstant > 40) {
      analysis += `ì¦‰ë‹µë¥ ì´ ë†’ì•„ ${target}ë‹˜ì˜ ë©”ì‹œì§€ì— ì¦‰ê°ì ìœ¼ë¡œ ë°˜ì‘í•˜ë©°, ëŒ€í™”ë¥¼ ë†“ì¹˜ì§€ ì•Šìœ¼ë ¤ëŠ” ëª¨ìŠµì—ì„œ ê´€ê³„ì— ëŒ€í•œ ì§„ì‹¬ì´ ëŠê»´ì§‘ë‹ˆë‹¤.`
    } else if (personAvgReply > 0 && personAvgReply < 30) {
      analysis += `ë¹ ë¥¸ ë‹µì¥ìœ¼ë¡œ ${target}ë‹˜ê³¼ì˜ ì†Œí†µì„ ìš°ì„ ì‹œí•˜ëŠ” íƒœë„ë¥¼ ë³´ì´ê³  ìˆìŠµë‹ˆë‹¤.`
    } else if (personAvgReply >= 30 && personAvgReply < 120) {
      analysis += `ì‹ ì¤‘í•˜ê²Œ ë‹µì¥ì„ ì‘ì„±í•˜ëŠ” ìŠ¤íƒ€ì¼ë¡œ, ${target}ë‹˜ì—ê²Œ ì‹ ê²½ ì“°ë©° ëŒ€í™”í•˜ëŠ” ëª¨ìŠµì´ ë³´ì…ë‹ˆë‹¤.`
    } else if (personAvgReply >= 120) {
      analysis += `ë‹µì¥ ì‹œê°„ì€ ë‹¤ì†Œ ì—¬ìœ  ìˆì§€ë§Œ, ëŒ€í™” ë‚´ìš©ì„ ë³´ë©´ ê´€ê³„ë¥¼ ì†Œì¤‘íˆ ì—¬ê¸°ê³  ìˆìŒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.`
    }

    return analysis.trim()
  }

  // AI ë§ì¶¤ ê³µëµë²• ìƒì„± í•¨ìˆ˜
  function generateAttackTip(person: string, target: string, personStats: any, targetStats: any, personCount: number, targetCount: number, personalityType: string) {
    const totalMessages = personCount + targetCount
    const personRatio = Math.round((personCount / totalMessages) * 100)
    const targetRatio = 100 - personRatio

    const personFirstMsg = personStats?.firstMessageCount || 0
    const targetFirstMsg = targetStats?.firstMessageCount || 0
    const personAvgReply = personStats?.avgReplyTime || 0
    const targetAvgReply = targetStats?.avgReplyTime || 0
    const personInstant = personStats?.instantReplyRate || 0
    const targetInstant = targetStats?.instantReplyRate || 0
    const personLaugh = personStats?.laughCount || 0
    const targetLaugh = targetStats?.laughCount || 0
    const personQuestion = personStats?.questionCount || 0
    const targetQuestion = targetStats?.questionCount || 0

    let tip = ''

    // 1. ì„±í–¥ë³„ ê¸°ë³¸ ì ‘ê·¼ë²•
    if (personalityType.includes('ì ê·¹ì ì¸ ê´€ì‹¬í˜•') || personalityType.includes('ì—´ì •ì ì¸ ì†Œí†µí˜•')) {
      tip += `${target}ë‹˜ì€ ê´€ì‹¬ê³¼ ì• ì • í‘œí˜„ì— ê¸ì •ì ìœ¼ë¡œ ë°˜ì‘í•˜ëŠ” íƒ€ì…ì…ë‹ˆë‹¤. `
      if (personFirstMsg < targetFirstMsg) {
        tip += `ìƒëŒ€ë°©ì´ ë¨¼ì € ì—°ë½í•˜ëŠ” ê±¸ ê¸°ë‹¤ë¦¬ê¸°ë³´ë‹¤ëŠ”, ë¨¼ì € ì—°ë½í•´ì„œ ê´€ì‹¬ì„ í‘œí˜„í•˜ë©´ íš¨ê³¼ì ì…ë‹ˆë‹¤. `
      }
      if (targetInstant > 30) {
        tip += `ë¹ ë¥´ê²Œ ë‹µì¥í•˜ëŠ” ìŠ¤íƒ€ì¼ì´ë¯€ë¡œ ì ê·¹ì ì¸ ëŒ€í™”ë¡œ í˜¸ê°ì„ ë†’ì¼ ìˆ˜ ìˆì–´ìš”. `
      }
    } else if (personalityType.includes('ì¿¨í•œ ë…ë¦½í˜•') || personalityType.includes('ììœ ë¡œìš´ ìì—°ì¸')) {
      tip += `${target}ë‹˜ì€ ê°œì¸ ê³µê°„ê³¼ ììœ ë¥¼ ì¤‘ì‹œí•˜ëŠ” íƒ€ì…ì…ë‹ˆë‹¤. `
      if (targetAvgReply > 60) {
        tip += `ë‹µì¥ ì‹œê°„ì´ ë‹¤ì†Œ ì—¬ìœ ë¡œìš´ í¸ì´ë¯€ë¡œ, ë„ˆë¬´ ìì£¼ ì—°ë½í•˜ê±°ë‚˜ ì¬ì´‰í•˜ì§€ ë§ê³  ì ì ˆí•œ ê±°ë¦¬ë¥¼ ìœ ì§€í•˜ì„¸ìš”. `
      }
      tip += `ì§‘ì°©í•˜ê±°ë‚˜ ë¶€ë‹´ì„ ì£¼ê¸°ë³´ë‹¤ëŠ” ì—¬ìœ ë¡­ê³  ì¿¨í•œ íƒœë„ë¡œ ì ‘ê·¼í•˜ëŠ” ê²ƒì´ íš¨ê³¼ì ì…ë‹ˆë‹¤. `
    } else if (personalityType.includes('ë”°ëœ»í•œ ê³µê°í˜•') || personalityType.includes('í—Œì‹ ì ì¸ ì¼€ì–´í˜•')) {
      tip += `${target}ë‹˜ì€ ê°ì •ì  êµê°ì„ ì¤‘ì‹œí•˜ëŠ” ë”°ëœ»í•œ íƒ€ì…ì…ë‹ˆë‹¤. `
      if (targetQuestion > personQuestion) {
        tip += `ìƒëŒ€ë°©ì´ ì§ˆë¬¸ì„ ë§ì´ í•˜ëŠ” í¸ì´ë¯€ë¡œ, ì†”ì§í•˜ê²Œ ë§ˆìŒì„ ë‚˜ëˆ„ê³  ê³µê°í•´ì£¼ëŠ” ëŒ€í™”ê°€ ì¤‘ìš”í•©ë‹ˆë‹¤. `
      }
      tip += `ì§„ì‹¬ ì–´ë¦° ê´€ì‹¬ê³¼ ì„¸ì‹¬í•œ ë°°ë ¤ë¥¼ ë³´ì—¬ì£¼ë©´ ë§ˆìŒì„ ì—´ê²Œ ë©ë‹ˆë‹¤. `
    } else if (personalityType.includes('ìœ ë¨¸ëŸ¬ìŠ¤í•œ ë¶„ìœ„ê¸°ë©”ì´ì»¤')) {
      tip += `${target}ë‹˜ì€ ì¦ê²ê³  ìœ ì¾Œí•œ ê´€ê³„ë¥¼ ì„ í˜¸í•˜ëŠ” íƒ€ì…ì…ë‹ˆë‹¤. `
      if (targetLaugh > totalMessages * 0.3) {
        tip += `ì›ƒìŒì´ ë§ì€ í¸ì´ë¯€ë¡œ ìœ ë¨¸ì™€ ì¬ì¹˜ë¡œ ì¦ê±°ìš´ ë¶„ìœ„ê¸°ë¥¼ ë§Œë“¤ë©´ íš¨ê³¼ì ì´ì—ìš”. `
      }
      tip += `ë¬´ê±°ìš´ ì£¼ì œë³´ë‹¤ëŠ” ê°€ë³ê³  ì¬ë¯¸ìˆëŠ” ëŒ€í™”ë¡œ ê´€ê³„ë¥¼ ë°œì „ì‹œí‚¤ì„¸ìš”. `
    } else if (personalityType.includes('ì§„ì§€í•œ ëŒ€í™”í˜•') || personalityType.includes('ì‹ ì¤‘í•œ ë¶„ì„í˜•')) {
      tip += `${target}ë‹˜ì€ ê¹Šì´ ìˆëŠ” ëŒ€í™”ì™€ ì§„ì •ì„±ì„ ì¤‘ì‹œí•˜ëŠ” íƒ€ì…ì…ë‹ˆë‹¤. `
      if (personStats?.avgMessageLength < targetStats?.avgMessageLength) {
        tip += `ìƒëŒ€ë°©ë³´ë‹¤ ì§§ì€ ë©”ì‹œì§€ë¥¼ ë³´ë‚´ëŠ” í¸ì´ë¯€ë¡œ, ì¢€ ë” êµ¬ì²´ì ì´ê³  ì§„ì§€í•œ ë‚´ìš©ìœ¼ë¡œ ëŒ€í™”í•˜ë©´ ì¢‹ìŠµë‹ˆë‹¤. `
      }
      tip += `ê°€ë²¼ìš´ ì¡ë‹´ë³´ë‹¤ëŠ” ì˜ë¯¸ ìˆëŠ” ì£¼ì œë¡œ ê¹Šì´ ìˆê²Œ ì†Œí†µí•˜ëŠ” ê²ƒì´ íš¨ê³¼ì ì…ë‹ˆë‹¤. `
    }

    // 2. ë‹µì¥ íŒ¨í„´ ê¸°ë°˜ ì¡°ì–¸
    if (targetInstant < 20 && targetAvgReply > 60) {
      tip += `ë‹µì¥ì´ ëŠë¦° í¸ì´ì§€ë§Œ ì´ëŠ” ì‹ ì¤‘í•œ ì„±ê²© ë•Œë¬¸ì¼ ìˆ˜ ìˆìœ¼ë‹ˆ, ì¬ì´‰í•˜ì§€ ë§ê³  ê¸°ë‹¤ë ¤ì£¼ëŠ” ì—¬ìœ ë¥¼ ê°€ì§€ì„¸ìš”. `
    } else if (targetInstant > 50) {
      tip += `ì¦‰ë‹µë¥ ì´ ë†’ì•„ ëŒ€í™”ë¥¼ ì¤‘ìš”í•˜ê²Œ ìƒê°í•˜ë¯€ë¡œ, ë¹ ë¥´ê²Œ ë‹µì¥í•˜ë©´ì„œ í˜¸í¡ì„ ë§ì¶”ë©´ ì¢‹ì€ ì¸ìƒì„ ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. `
    }

    // 3. ê´€ì‹¬ë„ ë¶ˆê· í˜• í•´ê²°
    const initiativeGap = Math.abs(personFirstMsg - targetFirstMsg)
    if (initiativeGap > 20) {
      if (personFirstMsg > targetFirstMsg * 2) {
        tip += `í˜„ì¬ ëŒ€í™”ë¥¼ ë„ˆë¬´ ìì£¼ ë¨¼ì € ì‹œì‘í•˜ê³  ìˆì–´ìš”. ìƒëŒ€ë°©ì´ ë¨¼ì € ì—°ë½í•  ê¸°íšŒë¥¼ ì£¼ê³ , ê´€ì‹¬ì˜ ê· í˜•ì„ ë§ì¶”ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤. `
      } else if (targetFirstMsg > personFirstMsg * 2) {
        tip += `ìƒëŒ€ë°©ì´ ë¨¼ì € ì—°ë½í•˜ëŠ” ê²½ìš°ê°€ ë§ìœ¼ë‹ˆ, ê°€ë”ì€ ë¨¼ì € ì—°ë½í•´ì„œ ê´€ì‹¬ì„ í‘œí˜„í•˜ë©´ ë” ì¢‹ì€ ê´€ê³„ë¡œ ë°œì „í•  ìˆ˜ ìˆì–´ìš”. `
      }
    }

    // 4. ê°ì • í‘œí˜„ ì¡°ì–¸
    const laughGap = Math.abs(personLaugh - targetLaugh) / totalMessages
    if (laughGap > 0.2) {
      if (personLaugh < targetLaugh * 0.5) {
        tip += `ìƒëŒ€ë°©ì´ ì¦ê±°ìš´ ë¶„ìœ„ê¸°ë¥¼ ë§Œë“¤ë ¤ ë…¸ë ¥í•˜ê³  ìˆìœ¼ë‹ˆ, ë” ì ê·¹ì ìœ¼ë¡œ ë°˜ì‘í•˜ê³  ì›ƒìŒìœ¼ë¡œ í™”ë‹µí•´ì£¼ì„¸ìš”. `
      }
    }

    // 5. ìµœì¢… ì¡°ì–¸
    tip += `ì§„ì‹¬ì„ ë‹´ì•„ ê¾¸ì¤€íˆ ì†Œí†µí•˜ë˜, ìƒëŒ€ë°©ì˜ í˜ì´ìŠ¤ë¥¼ ì¡´ì¤‘í•˜ë©° ì²œì²œíˆ ê´€ê³„ë¥¼ ë°œì „ì‹œì¼œ ë‚˜ê°€ì„¸ìš”.`

    return tip.trim()
  }

  // ë‘ ì‚¬ëŒì˜ í†µê³„ ë°ì´í„°
  const p1Stats = analysis?.participants?.[p1]
  const p2Stats = analysis?.participants?.[p2]

  const mutualPerception = {
    [p1]: {
      thinkingAboutYou: '', // ì‚¬ìš© ì•ˆ í•¨
      youThinkingAbout: generatePerceptionAnalysis(p1, p2, p1Stats, p2Stats, countP1, countP2)
    },
    [p2]: {
      thinkingAboutYou: '', // ì‚¬ìš© ì•ˆ í•¨
      youThinkingAbout: generatePerceptionAnalysis(p2, p1, p2Stats, p1Stats, countP2, countP1)
    }
  }

  // ê° ì‚¬ëŒë³„ ë§ì¶¤ ê³µëµë²• ìƒì„±
  const attackTips = {
    [p1]: generateAttackTip(p1, p2, p1Stats, p2Stats, countP1, countP2, personalities[p1].type),
    [p2]: generateAttackTip(p2, p1, p2Stats, p1Stats, countP2, countP1, personalities[p2].type)
  }

  return {
    score,
    relation: getRelationByScore(score, lang),
    summary: lang === 'ko'
      ? `${p1}ë‹˜ê³¼ ${p2}ë‹˜ì˜ ëŒ€í™” íŒ¨í„´ì„ ë¶„ì„í•œ ê²°ê³¼, ì„œë¡œì—ê²Œ í˜¸ê°ì´ ìˆëŠ” ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤. ëŒ€í™” ë¹ˆë„ì™€ ë°˜ì‘ ì†ë„ê°€ ì¢‹ì€ í¸ì´ì—ìš”.`
      : `Analysis of ${p1} and ${p2}'s conversation patterns shows mutual interest. Communication frequency and response speed are good.`,
    dominance: dominant,
    advice: lang === 'ko'
      ? `í˜„ì¬ ì¢‹ì€ íë¦„ì´ì—ìš”! í•˜ì§€ë§Œ ë„ˆë¬´ ê¸‰í•˜ê²Œ ì§„ë„ë¥¼ ë¹¼ë ¤ í•˜ì§€ ë§ˆì„¸ìš”. ${lessActive}ë‹˜ì´ ëŒ€í™”ë¥¼ ë” ë§ì´ ì£¼ë„í•˜ê³  ìˆì–´ìš”.`
      : `Things are going well! But don't rush the relationship. ${lessActive} is leading the conversations more.`,
    attackTip: attackTips,
    greenFlags: lang === 'ko' ? [
      'ë‹µì¥ ì†ë„ê°€ ë¹ ë¥¸ í¸',
      'ëŒ€í™”ê°€ ëŠê¸°ì§€ ì•Šê³  ì´ì–´ì§',
      'ì„œë¡œ ì§ˆë¬¸ì„ ì£¼ê³ ë°›ìŒ',
    ] : [
      'Fast response speed',
      'Continuous conversation flow',
      'Mutual question exchange',
    ],
    redFlags: lang === 'ko' ? [
      'ê°€ë” ì½ì”¹ì´ ìˆìŒ',
    ] : [
      'Occasional read-without-reply',
    ],
    personalities,
    mutualPerception,
  }
}
